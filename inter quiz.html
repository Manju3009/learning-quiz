<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ExamEdge Pro ‚Äî Competitive Exam Quiz Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#070711;--bg2:#0c0c1a;--card:#111120;--card2:#161628;--card3:#1c1c35;
  --b1:rgba(255,255,255,.06);--b2:rgba(255,255,255,.11);--b3:rgba(255,255,255,.18);
  --acc:#5b6af0;--acc2:#7c8bf5;--acc3:#a5aefa;
  --grad:linear-gradient(135deg,#5b6af0 0%,#8b5cf6 100%);
  --glow:0 0 40px rgba(91,106,240,.3);
  --green:#10d97e;--red:#ff4d6d;--amber:#fbbf24;--sky:#38bdf8;--pink:#f472b6;
  --easy:#10d97e;--mid:#fbbf24;--hard:#ff4d6d;
  --text:#eeeeff;--sub:#8888bb;--muted:#44446a;
  --r:16px;--r2:12px;--r3:8px;
  --font:'Outfit',sans-serif;
  --mono:'JetBrains Mono',monospace;
}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}

/* animated mesh bg */
.mesh{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.mesh span{position:absolute;border-radius:50%;filter:blur(80px);animation:drift 18s ease-in-out infinite alternate}
.mesh span:nth-child(1){width:600px;height:600px;background:rgba(91,106,240,.10);top:-200px;left:-150px;animation-delay:0s}
.mesh span:nth-child(2){width:500px;height:500px;background:rgba(139,92,246,.08);bottom:-180px;right:-120px;animation-delay:-6s}
.mesh span:nth-child(3){width:350px;height:350px;background:rgba(56,189,248,.06);top:40%;left:55%;animation-delay:-12s}
@keyframes drift{from{transform:translate(0,0) scale(1)}to{transform:translate(40px,30px) scale(1.08)}}

/* ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ */
.app{position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:0 1rem 2rem}
.wrap{width:100%;max-width:900px}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:1.4rem 0;width:100%;max-width:900px}
.logo-row{display:flex;align-items:center;gap:.75rem}
.logo-mark{width:44px;height:44px;border-radius:13px;background:var(--grad);display:flex;align-items:center;justify-content:center;font-size:1.3rem;box-shadow:var(--glow)}
.logo-text{font-weight:900;font-size:1.4rem;letter-spacing:-.02em}
.logo-text em{font-style:normal;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.logo-sub{font-size:.6rem;color:var(--sub);text-transform:uppercase;letter-spacing:.12em;margin-top:-3px}
.hud{display:none;align-items:center;gap:.6rem}
.hud.show{display:flex}
.hud-chip{display:flex;align-items:center;gap:.35rem;background:var(--card2);border:1px solid var(--b2);border-radius:20px;padding:.3rem .85rem;font-size:.76rem;font-weight:600}
.hud-chip.pts{color:var(--acc3)}
.hud-chip.usr{color:var(--green)}
.hud-logout{background:transparent;border:1px solid var(--b2);border-radius:8px;padding:.3rem .7rem;font-size:.72rem;color:var(--sub);cursor:pointer;font-family:var(--font);transition:all .2s}
.hud-logout:hover{border-color:var(--red);color:var(--red)}

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen{display:none;animation:screenIn .4s cubic-bezier(.22,.68,0,1.2) both}
.screen.active{display:block}
@keyframes screenIn{from{opacity:0;transform:translateY(24px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}

/* ‚îÄ‚îÄ PANEL / CARD ‚îÄ‚îÄ */
.panel{background:var(--card);border:1px solid var(--b1);border-radius:var(--r);padding:2.5rem;position:relative;overflow:hidden}
.panel::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(91,106,240,.6),transparent)}
.panel-sm{padding:1.6rem}

/* ‚îÄ‚îÄ TYPOGRAPHY ‚îÄ‚îÄ */
.page-title{font-weight:900;font-size:clamp(1.6rem,4vw,2.1rem);letter-spacing:-.03em;line-height:1.15;margin-bottom:.3rem}
.page-title em{font-style:normal;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.page-sub{font-size:.88rem;color:var(--sub);margin-bottom:2rem;line-height:1.6}
.section-label{font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.12em;color:var(--sub);margin-bottom:.9rem}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.45rem;font-family:var(--font);font-weight:700;border:none;cursor:pointer;border-radius:var(--r2);transition:all .2s cubic-bezier(.25,.8,.25,1);user-select:none}
.btn:disabled{opacity:.3;cursor:not-allowed;pointer-events:none}
.btn-primary{background:var(--grad);color:#fff;padding:.9rem 2rem;font-size:.92rem;box-shadow:0 4px 20px rgba(91,106,240,.35)}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(91,106,240,.5)}
.btn-outline{background:var(--card2);color:var(--sub);border:1.5px solid var(--b2);padding:.8rem 1.4rem;font-size:.88rem}
.btn-outline:hover{border-color:var(--acc2);color:var(--acc3)}
.btn-ghost{background:transparent;color:var(--muted);border:1.5px dashed var(--b2);padding:.75rem 1.2rem;font-size:.82rem}
.btn-ghost:hover{border-color:var(--amber);color:var(--amber)}
.btn-check{background:linear-gradient(135deg,#10d97e,#0eb86e);color:#fff;padding:.8rem 1.4rem;font-size:.88rem;font-weight:700;box-shadow:0 4px 16px rgba(16,217,126,.3)}
.btn-check:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(16,217,126,.45)}
.btn-check:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none}
.btn-exit{background:transparent;color:var(--red);border:1.5px solid var(--red);padding:.75rem 1.2rem;font-size:.82rem}
.btn-exit:hover{background:rgba(255,77,109,.1);transform:translateY(-1px)}

/* Set Completion Overlay */
.set-overlay{display:none;position:fixed;inset:0;z-index:1000;background:rgba(10,10,26,.92);backdrop-filter:blur(12px);align-items:center;justify-content:center}
.set-overlay.show{display:flex}
.set-card{background:var(--card);border:1.5px solid var(--b2);border-radius:20px;padding:2.5rem 2rem;max-width:520px;width:90%;text-align:center;animation:setSlideIn .5s ease}
@keyframes setSlideIn{from{opacity:0;transform:translateY(30px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}
.set-card h2{font-size:1.8rem;font-weight:800;margin-bottom:.5rem;background:linear-gradient(135deg,var(--acc),var(--acc3));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;color:transparent}
.set-card .set-desc{color:var(--sub);font-size:.88rem;line-height:1.5;margin-bottom:1.5rem}
.set-stats{display:flex;justify-content:center;gap:1.2rem;margin-bottom:1.5rem}
.set-stat{background:var(--card2);border:1.5px solid var(--b2);border-radius:12px;padding:.8rem 1.2rem;min-width:90px}
.set-stat-val{font-size:1.4rem;font-weight:800;font-family:'JetBrains Mono',monospace}
.set-stat-val.green{color:var(--green)}.set-stat-val.amber{color:var(--amber)}.set-stat-val.red{color:var(--red)}
.set-stat-lbl{font-size:.62rem;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);margin-top:.2rem;font-weight:600}
.set-quote{background:linear-gradient(135deg,rgba(91,106,240,.08),rgba(139,92,246,.08));border-left:3px solid var(--acc);border-radius:0 10px 10px 0;padding:1rem 1.2rem;margin-bottom:1.5rem;text-align:left}
.set-quote q{font-style:italic;color:var(--text);font-size:.85rem;font-weight:500;line-height:1.5}
.set-quote .set-quote-author{color:var(--muted);font-size:.72rem;margin-top:.3rem;display:block}
.set-diff-flow{display:flex;align-items:center;justify-content:center;gap:.6rem;margin-bottom:1.5rem}
.set-diff-badge{padding:.35rem .8rem;border-radius:20px;font-size:.72rem;font-weight:700;letter-spacing:.5px;border:1.5px solid}
.set-diff-arrow{color:var(--muted);font-size:.8rem}
.btn-continue{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;padding:1rem 2.5rem;font-size:1rem;font-weight:700;border-radius:12px;border:none;cursor:pointer;transition:all .2s;box-shadow:0 4px 20px rgba(245,158,11,.3)}
.btn-continue:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(245,158,11,.45)}

/* History Review Overlay */
.hist-overlay{display:none;position:fixed;inset:0;z-index:1000;background:rgba(10,10,26,.94);backdrop-filter:blur(12px);overflow-y:auto;padding:2rem 1rem}
.hist-overlay.show{display:block}
.hist-review{max-width:700px;margin:0 auto}
.hist-review-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem}
.hist-review-hdr h2{font-size:1.4rem;font-weight:800;color:var(--text)}
.btn-close-hist{background:var(--card2);color:var(--sub);border:1.5px solid var(--b2);padding:.6rem 1.2rem;border-radius:10px;cursor:pointer;font-size:.82rem;font-weight:600;transition:all .2s}
.btn-close-hist:hover{border-color:var(--red);color:var(--red)}
.hist-summary{display:flex;gap:.8rem;margin-bottom:1.5rem;flex-wrap:wrap}
.hist-sum-box{background:var(--card);border:1.5px solid var(--b2);border-radius:10px;padding:.7rem 1rem;text-align:center;flex:1;min-width:80px}
.hist-sum-val{font-size:1.1rem;font-weight:800;font-family:'JetBrains Mono',monospace}
.hist-sum-lbl{font-size:.6rem;text-transform:uppercase;color:var(--muted);letter-spacing:.5px;margin-top:.15rem}
.hist-q{background:var(--card);border:1.5px solid var(--b2);border-radius:12px;padding:1rem;margin-bottom:.8rem}
.hist-q-top{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;flex-wrap:wrap}
.hist-q-num{font-size:.7rem;font-weight:700;color:var(--muted)}
.hist-q-diff{padding:.15rem .5rem;border-radius:10px;font-size:.6rem;font-weight:700;border:1px solid}
.hist-q-badge{padding:.15rem .5rem;border-radius:10px;font-size:.6rem;font-weight:700}
.hist-q-badge.ok{background:rgba(16,217,126,.15);color:var(--green)}
.hist-q-badge.bad{background:rgba(255,77,109,.15);color:var(--red)}
.hist-q-badge.skip{background:rgba(148,163,184,.1);color:var(--muted)}
.hist-q-text{font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:.5rem;line-height:1.4}
.hist-q-ans{font-size:.78rem;color:var(--sub);line-height:1.4}
.hist-q-ans .ca{color:var(--green);font-weight:600}
.hist-q-ans .wa{color:var(--red);font-weight:600}
.hist-q-explain{margin-top:.5rem;padding:.6rem .8rem;background:rgba(91,106,240,.06);border-left:2px solid var(--acc);border-radius:0 8px 8px 0;font-size:.75rem;color:var(--sub);line-height:1.4}
.hi-item-click{cursor:pointer;transition:border-color .2s}
.hi-item-click:hover{border-color:var(--acc2)}
.btn-danger{background:rgba(255,77,109,.12);color:var(--red);border:1.5px solid rgba(255,77,109,.3);padding:.8rem 1.4rem;font-size:.88rem}
.btn-danger:hover{background:rgba(255,77,109,.22);border-color:var(--red)}
.btn-full{width:100%}
.btn-row{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}

/* ‚îÄ‚îÄ INPUT ‚îÄ‚îÄ */
.field{margin-bottom:1.3rem}
.field label{display:block;font-size:.76rem;font-weight:700;color:var(--sub);text-transform:uppercase;letter-spacing:.1em;margin-bottom:.5rem}
.field input,.field select{width:100%;background:var(--card2);border:1.5px solid var(--b2);border-radius:var(--r2);padding:.85rem 1.1rem;font-family:var(--font);font-size:.92rem;color:var(--text);outline:none;transition:border-color .2s}
.field input:focus,.field select:focus{border-color:var(--acc2);box-shadow:0 0 0 3px rgba(91,106,240,.15)}
.field input::placeholder{color:var(--muted)}
.field .input-wrap{position:relative}
.field .input-icon{position:absolute;right:1rem;top:50%;transform:translateY(-50%);font-size:1.1rem;cursor:pointer;user-select:none}
.field-error{font-size:.72rem;color:var(--red);margin-top:.35rem;display:none}
.field-error.show{display:block}

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
#s-login{padding-top:5vh}
.login-box{max-width:440px;margin:0 auto}
.login-hero{text-align:center;margin-bottom:2rem}
.login-hero .hero-icon{font-size:3rem;margin-bottom:.75rem}
.auth-tabs{display:flex;background:var(--card2);border-radius:var(--r2);padding:.25rem;margin-bottom:1.8rem;gap:.25rem}
.auth-tab{flex:1;padding:.65rem;border-radius:var(--r3);font-size:.84rem;font-weight:700;background:transparent;border:none;color:var(--sub);cursor:pointer;font-family:var(--font);transition:all .2s}
.auth-tab.active{background:var(--acc);color:#fff;box-shadow:0 2px 10px rgba(91,106,240,.4)}
.form-section{display:none}
.form-section.active{display:block}
.divider{display:flex;align-items:center;gap:.8rem;margin:1rem 0;color:var(--muted);font-size:.72rem}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--b2)}
.demo-row{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.75rem}
.demo-chip{background:var(--card3);border:1px solid var(--b2);border-radius:8px;padding:.35rem .75rem;font-size:.7rem;color:var(--sub);cursor:pointer;transition:all .2s}
.demo-chip:hover{border-color:var(--acc2);color:var(--acc3)}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
.dash-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
.dash-stat{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r2);padding:1.2rem 1.4rem;display:flex;align-items:center;gap:.9rem}
.ds-icon{width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0}
.ds-val{font-weight:900;font-size:1.55rem;line-height:1;font-family:var(--mono)}
.ds-lbl{font-size:.68rem;color:var(--sub);text-transform:uppercase;letter-spacing:.08em;margin-top:.15rem}
.exam-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:.75rem;margin-bottom:1.5rem}
.exam-card{background:var(--card2);border:1.5px solid var(--b1);border-radius:var(--r2);padding:1.3rem 1.1rem;cursor:pointer;transition:all .22s cubic-bezier(.25,.8,.25,1);position:relative;overflow:hidden;text-align:left;user-select:none}
.exam-card::before{content:'';position:absolute;inset:0;opacity:0;transition:opacity .22s}
.exam-card:hover{border-color:var(--acc2);transform:translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,.4)}
.exam-card:hover::before{opacity:1}
.exam-card.selected{border-color:var(--acc);background:rgba(91,106,240,.1);box-shadow:0 0 0 3px rgba(91,106,240,.15)}
.exam-card .ec-check{position:absolute;top:9px;right:9px;width:20px;height:20px;border-radius:50%;background:var(--acc);display:none;align-items:center;justify-content:center;font-size:.6rem;font-weight:900;color:#fff;box-shadow:0 0 10px rgba(91,106,240,.5)}
.exam-card.selected .ec-check{display:flex}
.ec-badge{display:inline-flex;align-items:center;gap:.3rem;font-size:.58rem;font-weight:800;text-transform:uppercase;letter-spacing:.1em;padding:.18rem .55rem;border-radius:20px;margin-bottom:.65rem}
.ec-icon{font-size:1.7rem;display:block;margin-bottom:.5rem}
.ec-name{font-weight:800;font-size:.92rem;margin-bottom:.2rem}
.ec-info{font-size:.66rem;color:var(--sub)}

/* exam badge colours */
.eb-tnpsc{background:rgba(16,217,126,.12);border:1px solid rgba(16,217,126,.3);color:var(--easy)}
.eb-ssc{background:rgba(91,106,240,.12);border:1px solid rgba(91,106,240,.3);color:var(--acc3)}
.eb-rrb{background:rgba(251,191,36,.12);border:1px solid rgba(251,191,36,.3);color:var(--amber)}
.eb-bank{background:rgba(56,189,248,.12);border:1px solid rgba(56,189,248,.3);color:var(--sky)}
.eb-upsc{background:rgba(244,114,182,.12);border:1px solid rgba(244,114,182,.3);color:var(--pink)}
.eb-ese{background:rgba(255,77,109,.12);border:1px solid rgba(255,77,109,.3);color:var(--red)}
.eb-gate{background:rgba(139,92,246,.12);border:1px solid rgba(139,92,246,.3);color:#c084fc}
.eb-ugc{background:rgba(234,179,8,.12);border:1px solid rgba(234,179,8,.3);color:#eab308}

/* ‚îÄ‚îÄ RECENT HISTORY ‚îÄ‚îÄ */
.history-list{display:flex;flex-direction:column;gap:.5rem}
.hist-item{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r2);padding:.85rem 1.1rem;display:flex;align-items:center;gap:.9rem}
.hi-icon{font-size:1.2rem;width:36px;text-align:center}
.hi-info{flex:1}
.hi-name{font-weight:700;font-size:.85rem}
.hi-meta{font-size:.68rem;color:var(--sub);margin-top:.1rem}
.hi-score{font-weight:900;font-size:.95rem;font-family:var(--mono)}
.hi-score.good{color:var(--green)}.hi-score.avg{color:var(--amber)}.hi-score.poor{color:var(--red)}
.empty-state{text-align:center;padding:2rem;color:var(--muted);font-size:.85rem}

/* ‚îÄ‚îÄ SETUP SCREEN ‚îÄ‚îÄ */
.setup-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.2rem}
.qcount-row{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1.5rem}
.qc-btn{padding:.45rem 1.1rem;border-radius:20px;cursor:pointer;user-select:none;border:1.5px solid var(--b2);background:var(--card2);font-family:var(--font);font-weight:700;font-size:.8rem;color:var(--sub);transition:all .18s}
.qc-btn:hover{border-color:var(--acc2);color:var(--acc3)}
.qc-btn.active{background:var(--acc);border-color:var(--acc);color:#fff;box-shadow:0 2px 12px rgba(91,106,240,.4)}
.timer-config{background:var(--card2);border:1px solid var(--b2);border-radius:var(--r2);padding:1.4rem;margin-bottom:1.5rem}
.tc-header{display:flex;align-items:center;gap:.5rem;font-weight:700;font-size:.9rem;margin-bottom:1rem}
.timer-presets{display:flex;flex-wrap:wrap;gap:.45rem;margin-bottom:.9rem}
.tp-btn{padding:.38rem .85rem;border-radius:20px;cursor:pointer;user-select:none;border:1.5px solid var(--b2);background:var(--card);font-family:var(--font);font-weight:700;font-size:.75rem;color:var(--sub);transition:all .18s}
.tp-btn:hover{border-color:var(--acc2);color:var(--acc3)}
.tp-btn.active{background:var(--acc);border-color:var(--acc);color:#fff}
.custom-row{display:flex;align-items:center;gap:.9rem}
.custom-row label{font-size:.75rem;color:var(--sub);font-weight:700;white-space:nowrap}
input[type=range]{
appearance:none;          /* Standard */
-webkit-appearance:none;  /* Chrome, Safari */
flex:1;
height:5px;
background:var(--card);
border-radius:5px;
outline:none;
cursor:pointer;
}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--acc);cursor:pointer;box-shadow:0 0 8px rgba(91,106,240,.4)}
.tval{min-width:68px;background:var(--card);border:1.5px solid var(--acc);border-radius:8px;padding:.28rem .75rem;text-align:center;font-weight:900;font-size:.95rem;color:var(--acc3);font-family:var(--mono)}
.preview-box{background:var(--card2);border:1px solid var(--b2);border-radius:var(--r2);padding:1rem 1.3rem;margin-bottom:1.5rem}
.prev-row{display:flex;flex-wrap:wrap;gap:1.2rem;font-size:.78rem}
.prev-item strong{color:var(--acc3)}

/* ‚îÄ‚îÄ QUIZ SCREEN ‚îÄ‚îÄ */
.quiz-header{display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap;margin-bottom:.9rem}
.qh-left{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap}
.qh-pill{display:flex;align-items:center;gap:.3rem;background:var(--card2);border:1px solid var(--b2);border-radius:20px;padding:.25rem .75rem;font-size:.7rem;font-weight:700}
.qh-right{display:flex;gap:.5rem}
.qstat{display:flex;align-items:center;gap:.3rem;background:var(--card2);border:1px solid var(--b2);border-radius:10px;padding:.28rem .7rem;font-size:.78rem;font-weight:800}
.qstat.s-pts{color:var(--acc3)}.qstat.s-stk{color:var(--amber)}.qstat.s-stk.hidden{display:none}
.timer-bar-wrap{margin-bottom:.85rem}
.tbar-top{display:flex;align-items:center;gap:.9rem;margin-bottom:.4rem}
.tbar-track{flex:1;height:9px;background:var(--card2);border-radius:9px;overflow:hidden;position:relative}
.tbar-fill{height:100%;border-radius:9px;background:linear-gradient(90deg,var(--green),#4ade80);transition:width 1s linear,background .4s}
.tbar-fill.warn{background:linear-gradient(90deg,var(--amber),#fde68a)}
.tbar-fill.danger{background:linear-gradient(90deg,var(--red),#fb7185);animation:pulse-bar .5s ease infinite alternate}
@keyframes pulse-bar{to{opacity:.55}}
.timer-box{flex-shrink:0;width:56px;height:56px;border-radius:12px;background:var(--card2);border:2px solid var(--b2);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:border-color .3s}
.timer-box .tn{font-family:var(--mono);font-weight:700;font-size:1.3rem;line-height:1}
.timer-box .tl{font-size:.44rem;color:var(--sub);text-transform:uppercase;letter-spacing:.06em}
.timer-box.warn{border-color:var(--amber);color:var(--amber)}.timer-box.warn .tl{color:var(--amber)}
.timer-box.danger{border-color:var(--red);color:var(--red);animation:tshake .35s ease infinite}.timer-box.danger .tl{color:var(--red)}
@keyframes tshake{0%,100%{transform:rotate(0)}30%{transform:rotate(-3deg)}70%{transform:rotate(3deg)}}
.prog-wrap{margin-bottom:1rem}
.prog-meta{display:flex;justify-content:space-between;font-size:.72rem;color:var(--sub);font-weight:600;margin-bottom:.4rem}
.prog-meta .frac{color:var(--text);font-weight:800}
.prog-track{height:5px;background:var(--card2);border-radius:5px;overflow:hidden}
.prog-bar{height:100%;border-radius:5px;background:var(--grad);transition:width .5s cubic-bezier(.4,0,.2,1)}
/* ‚îÄ‚îÄ QUIZ LAYOUT (sidebar + main) ‚îÄ‚îÄ */
.quiz-layout{display:flex;gap:1.2rem;align-items:flex-start}
.quiz-sidebar{width:280px;min-width:280px;display:none;flex-direction:column;gap:.8rem;position:sticky;top:80px}
.quiz-main{flex:1;min-width:0}

/* sidebar panel */
.sb-panel{background:var(--card);border:1px solid var(--b1);border-radius:var(--r2);padding:1rem 1.1rem}
.sb-title{font-size:.65rem;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:.7rem}

/* sidebar stats */
.sb-stats{display:flex;flex-direction:column;gap:.55rem}
.sb-stat-row{display:flex;align-items:center;justify-content:space-between}
.sb-stat-label{display:flex;align-items:center;gap:.4rem;font-size:.78rem;color:var(--sub);font-weight:600}
.sb-stat-label .sb-ico{font-size:.85rem}
.sb-stat-val{font-weight:800;font-size:.9rem;color:var(--text)}
.sb-stat-val.acc-green{color:var(--green)}
.sb-stat-val.acc-amber{color:var(--amber)}
.sb-stat-val.acc-red{color:var(--red)}

/* sidebar progress bar */
.sb-prog{margin-top:.4rem}
.sb-prog-info{display:flex;justify-content:space-between;font-size:.68rem;color:var(--sub);font-weight:600;margin-bottom:.35rem}
.sb-prog-info span:first-child{color:var(--text)}
.sb-prog-track{height:6px;background:var(--card2);border-radius:6px;overflow:hidden}
.sb-prog-bar{height:100%;border-radius:6px;background:var(--grad);transition:width .5s cubic-bezier(.4,0,.2,1)}

/* sidebar question sets */
.sb-qset{margin-bottom:.6rem}
.sb-qset-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem}
.sb-qset-label{font-size:.72rem;font-weight:700;color:var(--text);display:flex;align-items:center;gap:.35rem}
.sb-qset-label .sb-diff-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.sb-qset-count{font-size:.62rem;color:var(--sub);font-weight:600}
.sb-qset-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px}
.sb-qbox{width:100%;aspect-ratio:1;border-radius:6px;background:var(--card2);border:1.5px solid var(--b2);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;font-size:.68rem;font-weight:700;color:var(--sub)}
.sb-qbox:hover{border-color:var(--acc2);transform:scale(1.08)}
.sb-qbox.cur{background:var(--acc);border-color:var(--acc);color:#fff;box-shadow:0 0 8px rgba(91,106,240,.5)}
.sb-qbox.ok{background:rgba(16,217,126,.15);border-color:var(--green);color:var(--green)}
.sb-qbox.bad{background:rgba(255,77,109,.15);border-color:var(--red);color:var(--red)}
.sb-qbox.skip{background:rgba(148,163,184,.1);border-color:var(--muted);color:var(--muted)}

/* sidebar difficulty journey */
.sb-journey{display:flex;flex-direction:column;gap:.4rem;max-height:180px;overflow-y:auto}
.sb-journey::-webkit-scrollbar{width:3px}
.sb-journey::-webkit-scrollbar-thumb{background:var(--b2);border-radius:3px}
.sb-jrow{display:flex;align-items:center;gap:.5rem;font-size:.72rem;padding:.3rem .45rem;border-radius:6px;background:var(--card2);border:1px solid var(--b2)}
.sb-jrow-num{font-weight:800;color:var(--muted);min-width:16px}
.sb-jrow-diff{font-weight:700;display:flex;align-items:center;gap:.25rem}
.sb-jrow-score{margin-left:auto;font-size:.62rem;color:var(--sub);font-weight:600}

/* question card */
.q-card{background:var(--card2);border:1px solid var(--b2);border-radius:var(--r2);padding:1.6rem 1.8rem;margin-bottom:.9rem}
.q-tags{display:flex;align-items:center;gap:.5rem;margin-bottom:.75rem;flex-wrap:wrap}
.qtag{display:inline-flex;align-items:center;gap:.25rem;padding:.18rem .65rem;border-radius:20px;font-size:.6rem;font-weight:800;text-transform:uppercase;letter-spacing:.08em}
.qtag-diff.easy{background:rgba(16,217,126,.12);border:1px solid rgba(16,217,126,.25);color:var(--easy)}
.qtag-diff.mid{background:rgba(251,191,36,.12);border:1px solid rgba(251,191,36,.25);color:var(--amber)}
.qtag-diff.hard{background:rgba(255,77,109,.12);border:1px solid rgba(255,77,109,.25);color:var(--red)}
.qtag-cat{background:rgba(91,106,240,.12);border:1px solid rgba(91,106,240,.25);color:var(--acc3)}
.q-num{font-size:.66rem;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.08em;margin-bottom:.45rem}
.q-text{font-weight:700;font-size:clamp(.97rem,2.5vw,1.15rem);line-height:1.6;color:var(--text)}
.multi-note{display:inline-flex;align-items:center;gap:.3rem;margin-top:.6rem;background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.25);border-radius:8px;padding:.3rem .7rem;font-size:.68rem;color:var(--amber);font-weight:600}

/* options */
.opts{display:flex;flex-direction:column;gap:.55rem;margin-bottom:.9rem}
.opt{background:var(--card2);border:1.5px solid var(--b1);border-radius:var(--r2);padding:.85rem 1.1rem;cursor:pointer;user-select:none;display:flex;align-items:flex-start;gap:.8rem;transition:all .18s cubic-bezier(.25,.8,.25,1);position:relative;overflow:hidden}
.opt:hover:not(:disabled):not(.locked){border-color:rgba(91,106,240,.5);background:rgba(91,106,240,.06);transform:translateX(3px)}
.opt.sel:not(.revealed){border-color:var(--acc);background:rgba(91,106,240,.12)}
.opt.correct{border-color:var(--green)!important;background:rgba(16,217,126,.1)!important;animation:popIn .35s ease}
.opt.wrong{border-color:var(--red)!important;background:rgba(255,77,109,.1)!important;animation:shakeX .3s ease}
.opt.locked{cursor:default}
@keyframes popIn{0%{transform:scale(1)}50%{transform:scale(1.015)}100%{transform:scale(1)}}
@keyframes shakeX{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-4px)}40%,80%{transform:translateX(4px)}}
.opt-key{width:28px;height:28px;border-radius:7px;flex-shrink:0;background:var(--card3);border:1.5px solid var(--b2);display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:800;color:var(--sub);transition:all .18s;margin-top:.05rem}
.opt.sel:not(.revealed) .opt-key{background:var(--acc);border-color:var(--acc);color:#fff}
.opt.correct .opt-key{background:var(--green);border-color:var(--green);color:#000}
.opt.wrong   .opt-key{background:var(--red);  border-color:var(--red);  color:#fff}
.opt-txt{flex:1;font-size:.9rem;font-weight:500;line-height:1.45}
.opt-ic{margin-left:auto;font-size:1rem;flex-shrink:0;display:none;margin-top:.05rem}
.opt.correct .opt-ic,.opt.wrong .opt-ic{display:block}

/* feedback */
.feedback{border-radius:var(--r2);padding:.85rem 1.1rem;display:none;align-items:flex-start;gap:.65rem;font-size:.84rem;font-weight:600;margin-bottom:.9rem}
.feedback.show{display:flex}
.feedback.ok{background:rgba(16,217,126,.1);border:1px solid rgba(16,217,126,.25);color:var(--green)}
.feedback.bad{background:rgba(255,77,109,.1);border:1px solid rgba(255,77,109,.25);color:var(--red)}
.feedback.skip{background:rgba(68,68,106,.15);border:1px solid rgba(68,68,106,.3);color:var(--muted)}
.feedback.timeout{background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.25);color:var(--amber)}
.fb-icon{font-size:1.1rem;flex-shrink:0;margin-top:.05rem}
.fb-body strong{font-weight:800}

/* explanation box */
.explain-box{display:none;background:var(--card3);border:1px solid var(--b2);border-left:3px solid var(--acc2);border-radius:var(--r2);padding:1rem 1.2rem;margin-bottom:.9rem;font-size:.83rem;line-height:1.65;color:var(--sub)}
.explain-box.show{display:block}
.explain-box .ex-title{font-weight:800;color:var(--acc3);font-size:.75rem;text-transform:uppercase;letter-spacing:.1em;margin-bottom:.4rem;display:flex;align-items:center;gap:.35rem}

/* quiz nav */
.quiz-nav{display:flex;gap:.65rem;align-items:center}

/* ‚îÄ‚îÄ STREAK TOAST ‚îÄ‚îÄ */
.streak-toast{position:fixed;top:18px;left:50%;transform:translateX(-50%) translateY(-14px);background:linear-gradient(135deg,var(--amber),#f97316);color:#000;font-weight:800;font-size:.92rem;border-radius:30px;padding:.5rem 1.5rem;box-shadow:0 8px 28px rgba(251,191,36,.4);z-index:1000;opacity:0;pointer-events:none;transition:all .3s cubic-bezier(.25,.8,.25,1);white-space:nowrap}
.streak-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.level-toast{position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-14px);font-weight:800;font-size:.92rem;border-radius:16px;padding:.7rem 1.8rem;box-shadow:0 8px 28px rgba(0,0,0,.4);z-index:999;opacity:0;pointer-events:none;transition:all .4s cubic-bezier(.25,.8,.25,1);color:#000;text-align:center;line-height:1.4}
.level-toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.level-toast.up{background:linear-gradient(135deg,#10d97e,#38bdf8)}
.level-toast.down{background:linear-gradient(135deg,#ff4d6d,#f97316)}

/* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
.result-hero{text-align:center;padding:1.2rem 0 .5rem}
.rh-emoji{font-size:3.2rem;animation:heroIn .6s cubic-bezier(.25,.8,.25,1) both}
@keyframes heroIn{0%{transform:scale(0) rotate(-15deg)}65%{transform:scale(1.12) rotate(5deg)}100%{transform:scale(1) rotate(0)}}
.rh-title{font-weight:900;font-size:1.8rem;letter-spacing:-.03em;margin:.5rem 0 .25rem}
.rh-title em{font-style:normal;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.rh-sub{font-size:.84rem;color:var(--sub)}

/* ring */
.ring-wrap{position:relative;display:inline-block;margin:1rem 0}
.ring-svg{transform:rotate(-90deg);filter:drop-shadow(0 0 16px rgba(91,106,240,.35))}
.ring-bg{fill:none;stroke:var(--card2);stroke-width:11}
.ring-fg{fill:none;stroke-width:11;stroke-linecap:round;transition:stroke-dashoffset 1.5s cubic-bezier(.4,0,.2,1)}
.ring-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.ring-pct{font-family:var(--mono);font-weight:700;font-size:2rem;line-height:1}
.ring-lbl{font-size:.55rem;color:var(--sub);text-transform:uppercase;letter-spacing:.1em}

/* stat boxes */
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:.65rem;margin:1rem 0}
.sbox{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r2);padding:.9rem .5rem;text-align:center}
.sbox .sv{font-family:var(--mono);font-weight:700;font-size:1.55rem;margin-bottom:.15rem;line-height:1}
.sbox .sl{font-size:.58rem;color:var(--sub);text-transform:uppercase;letter-spacing:.08em}
.sbox.sv-ok .sv{color:var(--green)}.sbox.sv-bad .sv{color:var(--red)}.sbox.sv-skip .sv{color:var(--muted)}.sbox.sv-pts .sv{color:var(--acc3)}

/* breakdown */
.bd-list{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1.3rem}
.bd-row{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r2);padding:.7rem 1rem;display:flex;align-items:center;gap:.8rem}
.bd-icon{font-size:1rem;width:30px;text-align:center}
.bd-info{flex:1;min-width:0}
.bd-name{font-weight:700;font-size:.83rem;margin-bottom:.25rem}
.bd-bar{height:4px;background:var(--b1);border-radius:4px;overflow:hidden}
.bd-fill{height:100%;border-radius:4px;transition:width 1.1s cubic-bezier(.4,0,.2,1)}
.bd-score{font-weight:800;font-size:.82rem;color:var(--acc3);white-space:nowrap;font-family:var(--mono)}

/* accuracy bar */
.acc-bar-wrap{margin:.5rem 0 1.2rem}
.acc-labels{display:flex;justify-content:space-between;font-size:.7rem;color:var(--sub);font-weight:600;margin-bottom:.35rem}
.acc-labels strong{color:var(--text)}
.acc-track{height:8px;background:var(--card2);border-radius:8px;overflow:hidden}
.acc-fill{height:100%;border-radius:8px;background:linear-gradient(90deg,var(--green),var(--acc));transition:width 1.3s cubic-bezier(.4,0,.2,1)}

/* review */
.review-hdr{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--b1);padding-bottom:.65rem;margin-bottom:.75rem;cursor:pointer;user-select:none}
.rh-ttl{font-weight:800;font-size:.9rem;color:var(--sub)}
.rh-ico{color:var(--muted);font-size:.75rem;transition:transform .3s}
.review-hdr.open .rh-ico{transform:rotate(180deg)}
.review-items{display:none;flex-direction:column;gap:.5rem;margin-bottom:1.4rem}
.review-items.open{display:flex}
.rv{background:var(--card2);border:1px solid var(--b1);border-left:3px solid;border-radius:var(--r2);padding:.75rem 1rem}
.rv.ok{border-left-color:var(--green)}.rv.bad{border-left-color:var(--red)}.rv.skip{border-left-color:var(--muted)}
.rv-top{display:flex;gap:.5rem;align-items:center;margin-bottom:.3rem;flex-wrap:wrap}
.rv-badge{font-size:.6rem;font-weight:800;padding:.15rem .55rem;border-radius:20px}
.rv.ok   .rv-badge{background:rgba(16,217,126,.12);color:var(--green)}
.rv.bad  .rv-badge{background:rgba(255,77,109,.12);color:var(--red)}
.rv.skip .rv-badge{background:rgba(68,68,106,.15);color:var(--muted)}
.rv-meta{font-size:.63rem;color:var(--muted)}
.rv-q{font-size:.83rem;font-weight:600;margin-bottom:.25rem;line-height:1.45}
.rv-ans{font-size:.75rem;color:var(--sub);margin-bottom:.3rem}
.rv-ans .ca{color:var(--green);font-weight:700}.rv-ans .wa{color:var(--red);font-weight:700}
.rv-explain{font-size:.76rem;color:var(--muted);line-height:1.55;border-top:1px solid var(--b1);padding-top:.4rem;margin-top:.3rem}

/* result actions */
.result-quote{background:linear-gradient(135deg,rgba(91,106,240,.08),rgba(139,92,246,.08));border-left:3px solid var(--acc);border-radius:0 12px 12px 0;padding:1.2rem 1.5rem;margin-top:1.5rem;text-align:left}
.result-quote q{font-style:italic;color:var(--text);font-size:.92rem;font-weight:500;line-height:1.6;display:block}
.result-quote .rq-author{color:var(--muted);font-size:.75rem;margin-top:.4rem;display:block}
.r-actions{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-top:1.5rem}
.r-actions-3{grid-template-columns:1fr 1fr 1fr}
.ra-btn{
display:flex;
align-items:center;
justify-content:center;
gap:.4rem;
padding:1rem;
border-radius:var(--r2);
font-family:var(--font);
font-weight:800;
font-size:.92rem;
cursor:pointer;
border:none;
transition:all .2s;
user-select:none;
}
.ra-primary{background:linear-gradient(135deg,#10d97e,#0eb86e);color:#fff;box-shadow:0 4px 18px rgba(16,217,126,.35)}
.ra-primary:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(16,217,126,.5)}
.ra-retry-btn{background:var(--card2);border:1.5px solid var(--amber);color:var(--amber)}
.ra-retry-btn:hover{background:rgba(251,191,36,.1);transform:translateY(-1px)}
.ra-exit{background:var(--card2);border:1.5px solid var(--red);color:var(--red)}
.ra-exit:hover{background:rgba(255,77,109,.1);transform:translateY(-1px)}

/* ‚îÄ‚îÄ STATS SCREEN ‚îÄ‚îÄ */
.stats-hero{text-align:center;margin-bottom:1.5rem}
.stats-overview{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem;margin-bottom:1.5rem}
.so-card{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r2);padding:1.1rem;text-align:center}
.so-val{font-family:var(--mono);font-weight:700;font-size:1.7rem;line-height:1}
.so-lbl{font-size:.65rem;color:var(--sub);text-transform:uppercase;letter-spacing:.08em;margin-top:.2rem}
.leaderboard{display:flex;flex-direction:column;gap:.45rem;margin-bottom:1.3rem}
.lb-row{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r2);padding:.7rem 1rem;display:flex;align-items:center;gap:.8rem}
.lb-rank{width:28px;font-family:var(--mono);font-weight:700;font-size:.85rem;color:var(--muted);text-align:center;flex-shrink:0}
.lb-rank.gold{color:#fbbf24}.lb-rank.silver{color:#94a3b8}.lb-rank.bronze{color:#b45309}
.lb-name{flex:1;font-weight:700;font-size:.85rem}
.lb-score{font-family:var(--mono);font-weight:700;font-size:.9rem;color:var(--acc3)}
.lb-badge{font-size:.62rem;padding:.15rem .5rem;background:rgba(91,106,240,.12);border:1px solid rgba(91,106,240,.25);border-radius:20px;color:var(--acc3);font-weight:700}
.perf-grid{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-bottom:1.3rem}
.perf-card{background:var(--card2);border:1px solid var(--b1);border-radius:var(--r2);padding:1.1rem}
.pc-label{font-size:.68rem;font-weight:700;color:var(--sub);text-transform:uppercase;letter-spacing:.1em;margin-bottom:.5rem}
.pc-val{font-family:var(--mono);font-weight:700;font-size:1.3rem;margin-bottom:.4rem}
.pc-bar{height:6px;background:var(--b1);border-radius:6px;overflow:hidden}
.pc-fill{height:100%;border-radius:6px;transition:width 1s cubic-bezier(.4,0,.2,1)}

/* ‚îÄ‚îÄ NAV TABS ‚îÄ‚îÄ */
.nav-tabs{display:flex;gap:.35rem;background:var(--card);border:1px solid var(--b1);border-radius:var(--r2);padding:.3rem;margin-bottom:1.5rem}
.nav-tab{flex:1;padding:.6rem .5rem;border-radius:var(--r3);font-size:.75rem;font-weight:700;background:transparent;border:none;color:var(--sub);cursor:pointer;font-family:var(--font);transition:all .2s;text-align:center;white-space:nowrap}
.nav-tab.active{background:var(--acc);color:#fff;box-shadow:0 2px 10px rgba(91,106,240,.3)}
.nav-tab:hover:not(.active){color:var(--acc3)}

/* ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ */
.cf-layer{position:fixed;inset:0;pointer-events:none;z-index:500;overflow:hidden}
.cf-p{position:absolute;width:8px;height:8px;border-radius:2px;animation:cfDrop linear forwards}
@keyframes cfDrop{from{transform:translateY(-20px) rotate(0)}to{transform:translateY(100vh) rotate(720deg);opacity:0}}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:620px){
  .panel{padding:1.4rem}
  .q-card{padding:1.2rem 1.1rem}
  .setup-row{grid-template-columns:1fr}
  .stat-grid{grid-template-columns:repeat(2,1fr)}
  .r-actions,.r-actions-3{grid-template-columns:1fr}
  .dash-grid{grid-template-columns:1fr}
  .stats-overview{grid-template-columns:1fr 1fr}
  .perf-grid{grid-template-columns:1fr}
  .quiz-layout{flex-direction:column}
  .quiz-sidebar{width:100%;min-width:unset;position:static;flex-direction:column}
  .sb-qset-grid{grid-template-columns:repeat(5,1fr)}
  .sb-qbox{font-size:.6rem}
}
</style>
</head>
<body>
<div class="mesh"><span></span><span></span><span></span></div>
<div class="cf-layer" id="cf-layer"></div>
<div class="streak-toast" id="streak-toast">üî• <span id="stk-msg">3√ó Streak!</span></div>
<div class="level-toast" id="level-toast"><span id="lvl-msg">Level Up!</span></div>

<div class="app">
  <nav class="topbar wrap">
    <div class="logo-row">
      <div class="logo-mark">üìö</div>
      <div>
        <div class="logo-text"><em>ExamEdge</em> Pro</div>
        <div class="logo-sub">Competitive Exam Platform</div>
      </div>
    </div>
    <div class="hud" id="hud">
      <div class="hud-chip usr" id="hud-user">üë§ Guest</div>
      <div class="hud-chip pts" id="hud-pts">‚ö° 0 pts</div>
      <button class="hud-logout" id="btn-logout">Sign out</button>
    </div>
  </nav>

  <div class="wrap">
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         S1 ‚Äî LOGIN
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen active" id="s-login">
      <div class="login-box">
        <div class="login-hero">
          <div class="hero-icon">üéì</div>
          <div class="page-title" style="font-size:1.8rem">Welcome to <em>ExamEdge Pro</em></div>
          <p style="font-size:.85rem;color:var(--sub);margin-top:.4rem">India's most comprehensive exam prep platform</p>
        </div>
        <div class="panel">
          <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login">Sign In</button>
            <button class="auth-tab" data-tab="register">Register</button>
          </div>
          <!-- SIGN IN -->
          <div class="form-section active" id="form-login">
            <div class="field">
              <label>Username</label>
              <div class="input-wrap">
                <input type="text" id="li-user" placeholder="Enter username" autocomplete="username"/>
              </div>
              <div class="field-error" id="li-user-err">Please enter your username</div>
            </div>
            <div class="field">
              <label>Password</label>
              <div class="input-wrap">
                <input type="password" id="li-pass" placeholder="Enter password" autocomplete="current-password"/>
                <span class="input-icon" id="li-eye">üëÅ</span>
              </div>
              <div class="field-error" id="li-pass-err">Please enter your password</div>
            </div>
            <div class="field-error" id="li-main-err" style="display:none;font-size:.82rem;text-align:center">‚ùå Invalid credentials.</div>
            <button class="btn btn-primary btn-full" id="btn-login">Sign In ‚Üí</button>
          </div>
          <!-- REGISTER -->
          <div class="form-section" id="form-register">
            <div class="field">
              <label>Full Name</label>
              <input type="text" id="rg-name" placeholder="Your full name"/>
              <div class="field-error" id="rg-name-err">Name must be at least 2 characters</div>
            </div>
            <div class="field">
              <label>Username</label>
              <input type="text" id="rg-user" placeholder="Choose a username" autocomplete="username"/>
              <div class="field-error" id="rg-user-err">Username must be 3+ characters</div>
            </div>
            <div class="field">
              <label>Password</label>
              <div class="input-wrap">
                <input type="password" id="rg-pass" placeholder="Min 6 characters" autocomplete="new-password"/>
                <span class="input-icon" id="rg-eye">üëÅ</span>
              </div>
              <div class="field-error" id="rg-pass-err">Password must be at least 6 characters</div>
            </div>
            <div class="field-error" id="rg-main-err" style="display:none;font-size:.82rem;text-align:center"></div>
            <button class="btn btn-primary btn-full" id="btn-register">Create Account ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         S2 ‚Äî DASHBOARD
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="s-dashboard">
      <div class="nav-tabs" id="main-tabs">
        <button class="nav-tab active" data-s="dash">üè† Dashboard</button>
        <button class="nav-tab" data-s="setup">üìù New Quiz</button>
        <button class="nav-tab" data-s="stats">üìä Statistics</button>
      </div>

      <!-- DASHBOARD TAB -->
      <div id="tab-dash">
        <div class="page-title" style="margin-bottom:.3rem">Hello, <em id="d-name">Learner</em>! üëã</div>
        <p class="page-sub" style="margin-bottom:1.2rem">Pick an exam, set your difficulty and start practising</p>
        <div class="dash-grid">
          <div class="dash-stat">
            <div class="ds-icon" style="background:rgba(16,217,126,.15)">‚úÖ</div>
            <div><div class="ds-val" id="ds-total">0</div><div class="ds-lbl">Quizzes Taken</div></div>
          </div>
          <div class="dash-stat">
            <div class="ds-icon" style="background:rgba(91,106,240,.15)">‚ö°</div>
            <div><div class="ds-val" id="ds-pts">0</div><div class="ds-lbl">Total Points</div></div>
          </div>
          <div class="dash-stat">
            <div class="ds-icon" style="background:rgba(251,191,36,.15)">üéØ</div>
            <div><div class="ds-val" id="ds-acc">‚Äî</div><div class="ds-lbl">Best Accuracy</div></div>
          </div>
          <div class="dash-stat">
            <div class="ds-icon" style="background:rgba(255,77,109,.15)">üî•</div>
            <div><div class="ds-val" id="ds-streak">0</div><div class="ds-lbl">Best Streak</div></div>
          </div>
        </div>
        <div class="section-label">Recent Attempts</div>
        <div class="history-list" id="history-list">
          <div class="empty-state">üì≠ No quizzes yet ‚Äî take your first quiz!</div>
        </div>
        <button class="btn btn-primary" style="margin-top:1rem" id="btn-go-setup">üöÄ Start New Quiz</button>
      </div>

      <!-- SETUP TAB -->
      <div id="tab-setup" style="display:none">
        <div class="page-title">Configure <em>Your Quiz</em></div>
        <p class="page-sub">Select exam categories to begin</p>

        <div class="section-label">1 ‚Äî Choose Exam Categories (multi-select)</div>
        <div class="exam-grid" id="exam-grid"></div>



        <!-- hidden stubs for preview JS refs -->
        <span id="pv-exams" style="display:none"></span>
        <span id="pv-diff" style="display:none"></span>
        <span id="pv-count" style="display:none"></span>
        <!-- hidden stubs for JS compatibility -->
        <span id="qcount-display" style="display:none"></span>
        <span id="qcount-avail" style="display:none"></span>
        <div id="tval-box" style="display:none">20s</div>
        <div id="timer-presets" style="display:none"></div>
        <input type="range" id="t-slider" min="5" max="120" value="20" step="5" style="display:none"/>
        <span id="pv-timer" style="display:none"></span>

        <div class="btn-row">
          <button class="btn btn-primary" id="btn-start-quiz" disabled>üöÄ Start Quiz</button>
          <button class="btn btn-outline" id="btn-reset-setup">Reset</button>
        </div>
      </div>

      <!-- STATS TAB -->
      <div id="tab-stats" style="display:none">
        <div class="stats-hero">
          <div class="page-title">Your <em>Statistics</em></div>
          <p style="font-size:.84rem;color:var(--sub)">Track your performance over time</p>
        </div>
        <div class="stats-overview">
          <div class="so-card"><div class="so-val" style="color:var(--green)" id="so-total">0</div><div class="so-lbl">Total Quizzes</div></div>
          <div class="so-card"><div class="so-val" style="color:var(--acc3)" id="so-pts">0</div><div class="so-lbl">Total Points</div></div>
          <div class="so-card"><div class="so-val" style="color:var(--amber)" id="so-avg">‚Äî</div><div class="so-lbl">Avg Accuracy</div></div>
        </div>
        <div class="section-label">Performance by Exam</div>
        <div id="perf-grid" class="perf-grid"></div>
        <div class="section-label">Your Stats</div>
        <div class="leaderboard" id="leaderboard"></div>
        <div class="section-label">Recent History (All Attempts)</div>
        <div class="history-list" id="stats-history"></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         S3 ‚Äî QUIZ
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="s-quiz">
      <div class="quiz-header">
        <div class="qh-left">
          <div class="qh-pill" id="qh-exam">üìö Exam</div>
          <div class="qh-pill" id="qh-diff">üå± Easy</div>
          <div class="qh-pill" id="qh-timer" style="color:var(--amber)">‚è± ‚Äîs/Q</div>
        </div>
        <div class="qh-right">
          <div class="qstat s-pts">‚ö° <span id="qs-pts">0</span></div>
          <div class="qstat s-stk hidden" id="qs-stk-box">üî• <span id="qs-stk">0</span></div>
        </div>
      </div>
      <div class="timer-bar-wrap">
        <div class="tbar-top">
          <div class="tbar-track"><div class="tbar-fill" id="tbar-fill"></div></div>
          <div class="timer-box" id="timer-box">
            <div class="tn" id="t-num">‚Äî</div>
            <div class="tl">sec</div>
          </div>
        </div>
      </div>

      <div class="quiz-layout">
        <!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
        <div class="quiz-sidebar" id="quiz-sidebar">
          <!-- Stats -->
          <div class="sb-panel">
            <div class="sb-stats">
              <div class="sb-stat-row">
                <div class="sb-stat-label"><span class="sb-ico">‚ö°</span> Points</div>
                <div class="sb-stat-val" id="sb-pts">0</div>
              </div>
              <div class="sb-stat-row">
                <div class="sb-stat-label"><span class="sb-ico">üéØ</span> Accuracy</div>
                <div class="sb-stat-val" id="sb-acc">0%</div>
              </div>
              <div class="sb-stat-row">
                <div class="sb-stat-label"><span class="sb-ico">üî•</span> Streak</div>
                <div class="sb-stat-val" id="sb-streak">0</div>
              </div>
              <div class="sb-stat-row">
                <div class="sb-stat-label"><span class="sb-ico">‚è±</span> Avg Time</div>
                <div class="sb-stat-val" id="sb-avgtime">0s</div>
              </div>
            </div>
          </div>

          <!-- Overall Progress -->
          <div class="sb-panel">
            <div class="sb-title">Overall Progress</div>
            <div class="sb-prog">
              <div class="sb-prog-info"><span id="sb-prog-ans">0 answered</span><span id="sb-prog-pct">0%</span></div>
              <div class="sb-prog-track"><div class="sb-prog-bar" id="sb-prog-bar"></div></div>
            </div>
          </div>

          <!-- Question Sets -->
          <div class="sb-panel">
            <div class="sb-title">Question Sets</div>
            <div id="sb-qsets"></div>
          </div>

          <!-- Difficulty Journey -->
          <div class="sb-panel">
            <div class="sb-title">Difficulty Journey</div>
            <div class="sb-journey" id="sb-journey"></div>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ MAIN QUIZ ‚îÄ‚îÄ -->
        <div class="quiz-main">
          <div class="q-card">
            <div class="q-tags">
              <span class="qtag qtag-diff" id="qt-diff">üå± Easy</span>
              <span class="qtag qtag-cat" id="qt-cat">üìö</span>
            </div>
            <div class="q-num" id="q-num-lbl">Question 1 of 10</div>
            <div class="q-text" id="q-text">Loading‚Ä¶</div>
            <div class="multi-note" id="multi-note" style="display:none">‚ö†Ô∏è Multiple correct answers ‚Äî select all that apply</div>
          </div>
          <div class="opts" id="opts"></div>
          <div class="feedback" id="feedback"></div>
          <div class="explain-box" id="explain-box">
            <div class="ex-title">üí° Explanation</div>
            <div id="explain-text"></div>
          </div>
          <div class="quiz-nav">
            <button class="btn btn-outline" id="btn-qback" disabled>‚Üê Back</button>
            <button class="btn btn-ghost" id="btn-skip">Skip</button>
            <button class="btn btn-check" id="btn-check" disabled>Check ‚úì</button>
            <button class="btn btn-primary" id="btn-qnext" disabled>Next ‚Üí</button>
            <button class="btn btn-exit" id="btn-exit">Exit</button>
          </div>
        </div>
      </div>
    </div>

    <!-- History Review Overlay -->
    <div class="hist-overlay" id="hist-overlay">
      <div class="hist-review">
        <div class="hist-review-hdr">
          <h2 id="hist-review-title">Quiz Review</h2>
          <button class="btn-close-hist" id="btn-close-hist">‚úï Close</button>
        </div>
        <div class="hist-summary" id="hist-summary"></div>
        <div id="hist-questions"></div>
      </div>
    </div>

    <!-- Set Completion Overlay -->
    <div class="set-overlay" id="set-overlay">
      <div class="set-card">
        <h2 id="set-title">Charging Up!</h2>
        <p class="set-desc" id="set-desc">Each question you attempt builds your mental database.</p>
        <div class="set-stats">
          <div class="set-stat"><div class="set-stat-val green" id="set-correct">0/5</div><div class="set-stat-lbl">Correct</div></div>
          <div class="set-stat"><div class="set-stat-val amber" id="set-pts">0</div><div class="set-stat-lbl">Points</div></div>
          <div class="set-stat"><div class="set-stat-val" id="set-acc">0%</div><div class="set-stat-lbl">Accuracy</div></div>
        </div>
        <div class="set-quote" id="set-quote-box">
          <q id="set-quote-text">Progress is the goal.</q>
          <span class="set-quote-author" id="set-quote-author">‚Äî Unknown</span>
        </div>
        <div class="set-diff-flow" id="set-diff-flow"></div>
        <button class="btn-continue" id="btn-continue">Continue Next Set ‚Üí</button>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         S4 ‚Äî RESULTS
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="s-result">
      <div class="panel">
        <div class="result-hero">
          <div class="rh-emoji" id="rh-emoji">üéâ</div>
          <div class="rh-title"><em id="rh-title">Well Done!</em></div>
          <div class="rh-sub" id="rh-sub">Here's how you performed</div>
          <div class="ring-wrap">
            <svg class="ring-svg" width="148" height="148" viewBox="0 0 148 148">
              <circle class="ring-bg" cx="74" cy="74" r="60"/>
              <circle class="ring-fg" id="ring-fg" cx="74" cy="74" r="60" stroke-dasharray="376.99" stroke-dashoffset="376.99"/>
            </svg>
            <div class="ring-center">
              <div class="ring-pct" id="ring-pct">0%</div>
              <div class="ring-lbl">accuracy</div>
            </div>
          </div>
        </div>
        <div class="result-quote" id="result-quote">
          <q id="rq-text"></q>
          <span class="rq-author" id="rq-author"></span>
        </div>
        <div class="acc-bar-wrap">
          <div class="acc-labels"><span>Overall Accuracy</span><strong id="acc-txt">0%</strong></div>
          <div class="acc-track"><div class="acc-fill" id="acc-fill" style="width:0"></div></div>
        </div>
        <div class="stat-grid">
          <div class="sbox sv-ok"><div class="sv" id="r-cor">0</div><div class="sl">Correct</div></div>
          <div class="sbox sv-bad"><div class="sv" id="r-wrg">0</div><div class="sl">Wrong</div></div>
          <div class="sbox sv-skip"><div class="sv" id="r-skp">0</div><div class="sl">Skipped</div></div>
          <div class="sbox sv-pts"><div class="sv" id="r-pts">0</div><div class="sl">Points</div></div>
          <div class="sbox" style="border-color:var(--p2)"><div class="sv" id="r-time" style="color:var(--p2)">0:00</div><div class="sl">Time Taken</div></div>
          <div class="sbox" style="border-color:var(--amber)"><div class="sv" id="r-best-streak" style="color:var(--amber)">0</div><div class="sl">Best Streak</div></div>
          <div class="sbox" style="border-color:#a78bfa"><div class="sv" id="r-start-lvl" style="color:#a78bfa">‚Äî</div><div class="sl">Start Level</div></div>
          <div class="sbox" style="border-color:#f472b6"><div class="sv" id="r-end-lvl" style="color:#f472b6">‚Äî</div><div class="sl">Final Level</div></div>
        </div>
        <div class="section-label">Category Breakdown</div>
        <div class="bd-list" id="bd-list"></div>
        <div class="review-hdr" id="rv-hdr"><span class="rh-ttl">üìù Answer Review</span><span class="rh-ico">‚ñº</span></div>
        <div class="review-items" id="rv-items"></div>
        <div class="r-actions r-actions-3">
          <button class="ra-btn ra-primary" id="ra-retry">‚û°Ô∏è Continue Next</button>
          <button class="ra-btn ra-retry-btn" id="ra-retryexam">üîÅ Retry</button>
          <button class="ra-btn ra-exit" id="ra-dash">üö™ Leave</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="db.js"></script>
<script>
'use strict';
// DB loaded from db.js
void DB; // ensure DB is available
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE & AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let USERS = JSON.parse(localStorage.getItem('ee_users') || '{}');
if(!USERS['student1']) USERS['student1'] = {pass:'pass123',name:'Student One',history:[],points:0,bestStreak:0};
if(!USERS['testuser']) USERS['testuser'] = {pass:'quiz456',name:'Test User',history:[],points:0,bestStreak:0};
if(!USERS['admin'])    USERS['admin']    = {pass:'admin123',name:'Admin',history:[],points:0,bestStreak:0};

let CU = null; // current user key

const S = {
  exams:[],diff:'easy',qCount:15,secPerQ:20,
  qs:[],idx:0,score:0,streak:0,bestStreak:0,
  ans:[],timeTaken:[],timerId:null,timeLeft:0,
  answered:false,selectedOpts:new Set(),
  // Adaptive difficulty ‚Äî 5 levels mapped to 3 DB pools
  level:1, // 0=very_easy,1=easy,2=medium,3=hard,4=very_hard
  recentAns:[],
  diffHistory:[],
  pools:{},
  usedQs:{very_easy:new Set(),easy:new Set(),mid:new Set(),hard:new Set()}
};
const LEVEL_NAMES=['Very Easy','Easy','Medium','Hard','Very Hard'];
const LEVEL_ICONS=['üåø','üå±','‚ö°','üî•','üíÄ'];
const LEVEL_COLORS=['#10d97e','#38bdf8','#fbbf24','#f97316','#ff4d6d'];
const LEVEL_POINTS=[60,80,120,160,200];
// Map 5 levels to 4 DB pools: 0‚Üívery_easy 1‚Üíeasy 2‚Üímid 3,4‚Üíhard
const LEVEL_TO_POOL=['very_easy','easy','mid','hard','hard'];

function saveUsers(){ localStorage.setItem('ee_users',JSON.stringify(USERS)); }

// ‚îÄ‚îÄ Screens ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function show(id){
  document.querySelectorAll('.screen').forEach(s=>{s.classList.remove('active');s.style.display='none'});
  const el=document.getElementById(id);
  el.style.display='block';
  requestAnimationFrame(()=>el.classList.add('active'));
  // Show sidebar only on quiz screen
  const sb=document.getElementById('quiz-sidebar');
  if(sb) sb.style.display=(id==='s-quiz')?'flex':'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LOGIN / REGISTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.auth-tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.auth-tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    document.querySelectorAll('.form-section').forEach(x=>x.classList.remove('active'));
    document.getElementById('form-'+t.dataset.tab).classList.add('active');
  });
});

document.getElementById('li-eye').addEventListener('click',()=>{
  const i=document.getElementById('li-pass');
  i.type=i.type==='password'?'text':'password';
});
document.getElementById('rg-eye').addEventListener('click',()=>{
  const i=document.getElementById('rg-pass');
  i.type=i.type==='password'?'text':'password';
});

document.querySelectorAll('.demo-chip').forEach(c=>{
  c.addEventListener('click',()=>{
    document.getElementById('li-user').value=c.dataset.u;
    document.getElementById('li-pass').value=c.dataset.p;
    document.querySelector('[data-tab="login"]').click();
  });
});

function validate(id,errId,cond,msg){
  const err=document.getElementById(errId);
  if(!cond){ err.textContent=msg; err.classList.add('show'); return false; }
  err.classList.remove('show'); return true;
}

document.getElementById('btn-login').addEventListener('click',()=>{
  const u=document.getElementById('li-user').value.trim();
  const p=document.getElementById('li-pass').value;
  let ok=true;
  ok=validate('li-user','li-user-err',u,'Please enter your username') && ok;
  ok=validate('li-pass','li-pass-err',p,'Please enter your password') && ok;
  if(!ok) return;
  const err=document.getElementById('li-main-err');
  if(USERS[u] && USERS[u].pass===p){
    err.style.display='none';
    CU=u;
    document.getElementById('li-user').value='';
    document.getElementById('li-pass').value='';
    enterDashboard();
  } else {
    err.style.display='block';
  }
});

document.getElementById('btn-register').addEventListener('click',()=>{
  const n=document.getElementById('rg-name').value.trim();
  const u=document.getElementById('rg-user').value.trim();
  const p=document.getElementById('rg-pass').value;
  let ok=true;
  ok=validate('rg-name','rg-name-err',n.length>=2,'Name must be at least 2 characters') && ok;
  ok=validate('rg-user','rg-user-err',u.length>=3,'Username must be 3+ characters') && ok;
  ok=validate('rg-pass','rg-pass-err',p.length>=6,'Password must be at least 6 characters') && ok;
  if(!ok) return;
  const main=document.getElementById('rg-main-err');
  if(USERS[u]){ main.textContent='‚ùå Username already taken!'; main.style.display='block'; return; }
  main.style.display='none';
  USERS[u]={pass:p,name:n,history:[],points:0,bestStreak:0};
  saveUsers();
  CU=u;
  enterDashboard();
});

// allow Enter key
['li-user','li-pass'].forEach(id=>{
  document.getElementById(id).addEventListener('keydown',e=>{
    if(e.key==='Enter') document.getElementById('btn-login').click();
  });
});

document.getElementById('btn-logout').addEventListener('click',()=>{
  CU=null;
  document.getElementById('hud').classList.remove('show');
  show('s-login');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function enterDashboard(){
  const ud=USERS[CU];
  document.getElementById('hud').classList.add('show');
  document.getElementById('hud-user').textContent='üë§ '+ud.name;
  document.getElementById('hud-pts').textContent='‚ö° '+ud.points+' pts';
  switchTab('dash');
  show('s-dashboard');
}

function renderDashboard(){
  const ud=USERS[CU];
  document.getElementById('d-name').textContent=ud.name.split(' ')[0];
  document.getElementById('ds-total').textContent=ud.history.length;
  document.getElementById('ds-pts').textContent=ud.points;
  const accs=ud.history.map(h=>h.acc);
  document.getElementById('ds-acc').textContent=accs.length?Math.max(...accs)+'%':'‚Äî';
  document.getElementById('ds-streak').textContent=ud.bestStreak||0;
  renderHistory('history-list', ud.history.slice(-5).reverse());
}

function renderHistory(elId, list){
  const el=document.getElementById(elId);
  if(!list.length){ el.innerHTML='<div class="empty-state">üì≠ No quizzes yet!</div>'; return; }
  el.innerHTML=list.map((h,i)=>{
    const cls=h.acc>=80?'good':h.acc>=50?'avg':'poor';
    const clickable=h.questions?'hi-item-click':'';
    return `<div class="hist-item ${clickable}" data-hist-idx="${i}">
      <div class="hi-icon">${DB[h.exam]?.icon||'üìö'}</div>
      <div class="hi-info">
        <div class="hi-name">${DB[h.exam]?.name||h.exam} ‚Äî ${h.diff} (${h.count} Qs)</div>
        <div class="hi-meta">${h.date} ¬∑ ${h.correct}/${h.count} correct ¬∑ ${h.pts} pts</div>
      </div>
      <div class="hi-score ${cls}">${h.acc}%</div>
    </div>`;
  }).join('');
  // Click to review
  el.querySelectorAll('.hi-item-click').forEach(item=>{
    item.addEventListener('click',()=>{
      const idx=+item.dataset.histIdx;
      showHistReview(list[idx]);
    });
  });
}

function showHistReview(rec){
  if(!rec.questions||!rec.answers) return;
  const overlay=document.getElementById('hist-overlay');
  const examName=DB[rec.exam]?.name||rec.exam;
  document.getElementById('hist-review-title').textContent=examName+' ‚Äî '+rec.date;

  // Summary stats
  const accCol=rec.acc>=70?'var(--green)':rec.acc>=40?'var(--amber)':'var(--red)';
  document.getElementById('hist-summary').innerHTML=`
    <div class="hist-sum-box"><div class="hist-sum-val" style="color:var(--green)">${rec.correct}/${rec.count}</div><div class="hist-sum-lbl">Correct</div></div>
    <div class="hist-sum-box"><div class="hist-sum-val" style="color:var(--amber)">${rec.pts}</div><div class="hist-sum-lbl">Points</div></div>
    <div class="hist-sum-box"><div class="hist-sum-val" style="color:${accCol}">${rec.acc}%</div><div class="hist-sum-lbl">Accuracy</div></div>
    <div class="hist-sum-box"><div class="hist-sum-val" style="color:var(--red)">${rec.skipped||0}</div><div class="hist-sum-lbl">Skipped</div></div>`;

  // Questions
  const qEl=document.getElementById('hist-questions');
  qEl.innerHTML=rec.questions.map((q,i)=>{
    const a=rec.answers[i];
    if(!a) return '';
    const lvl=q._diff!=null?q._diff:(rec.diffHistory?rec.diffHistory[i]:1);
    const diffName=LEVEL_NAMES[lvl]||'Easy';
    const diffColor=LEVEL_COLORS[lvl]||'#38bdf8';
    const isTimeout=a.timedOut;
    let badgeCls,badgeTxt;
    if(a.ok){badgeCls='ok';badgeTxt='‚úì Correct';}
    else if(a.skipped){badgeCls='skip';badgeTxt='‚ö° Skipped';}
    else if(isTimeout){badgeCls='skip';badgeTxt='‚è± Timed Out';}
    else{badgeCls='bad';badgeTxt='‚úó Wrong';}

    let ansLine='';
    if(a.skipped||isTimeout){
      ansLine=isTimeout?'<span style="color:var(--amber)">Time ran out</span>':'<span style="color:var(--muted)">Skipped</span>';
    } else if(a.ok){
      ansLine='Your answer: <span class="ca">'+a.selected.map(si=>q.o[si]).join(' / ')+'</span>';
    } else {
      ansLine='Your: <span class="wa">'+(a.selected.length?a.selected.map(si=>q.o[si]).join(' / '):'‚Äî')+'</span> ‚Üí Correct: <span class="ca">'+a.correct.map(ci=>q.o[ci]).join(' / ')+'</span>';
    }

    const explainHtml=(a.ok||(!a.skipped&&!isTimeout))?'<div class="hist-q-explain">üí° '+q.e+'</div>':'';

    return '<div class="hist-q">'+
      '<div class="hist-q-top">'+
        '<span class="hist-q-num">Q'+(i+1)+'</span>'+
        '<span class="hist-q-diff" style="color:'+diffColor+';border-color:'+diffColor+'">'+diffName+'</span>'+
        '<span class="hist-q-badge '+badgeCls+'">'+badgeTxt+'</span>'+
      '</div>'+
      '<div class="hist-q-text">'+q.q+'</div>'+
      '<div class="hist-q-ans">'+ansLine+'</div>'+
      explainHtml+
    '</div>';
  }).join('');

  overlay.classList.add('show');
}

document.getElementById('btn-close-hist').addEventListener('click',()=>{
  document.getElementById('hist-overlay').classList.remove('show');
});

// ‚îÄ‚îÄ TAB NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('main-tabs').addEventListener('click',e=>{
  if(e.target.classList.contains('nav-tab')) switchTab(e.target.dataset.s);
});
document.getElementById('btn-go-setup').addEventListener('click',()=>switchTab('setup'));

function switchTab(tab){
  ['dash','setup','stats'].forEach(t=>{
    document.getElementById('tab-'+t).style.display='none';
    document.querySelector(`[data-s="${t}"]`)?.classList.remove('active');
  });
  document.getElementById('tab-'+tab).style.display='block';
  document.querySelector(`[data-s="${tab}"]`)?.classList.add('active');
  if(tab==='dash') renderDashboard();
  if(tab==='stats') renderStats();
  if(tab==='setup') buildExamGrid();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildExamGrid(){
  const g=document.getElementById('exam-grid');
  g.innerHTML='';
  Object.entries(DB).forEach(([key,ex])=>{
    const c=document.createElement('div');
    c.className='exam-card'+(S.exams.includes(key)?' selected':'');
    c.dataset.key=key;
    c.innerHTML=`<div class="ec-check">‚úì</div>
      <span class="ec-badge ${ex.badge}">${ex.label}</span>
      <span class="ec-icon">${ex.icon}</span>
      <div class="ec-name">${ex.name}</div>
      <div class="ec-info">${ex.desc}</div>`;
    c.addEventListener('click',()=>toggleExam(key,c));
    g.appendChild(c);
  });
  updatePreview();
}

function toggleExam(key,el){
  const i=S.exams.indexOf(key);
  if(i===-1){ S.exams.push(key); el.classList.add('selected'); }
  else { S.exams.splice(i,1); el.classList.remove('selected'); }
  updatePreview();
  document.getElementById('btn-start-quiz').disabled=!S.exams.length;
}

// Fixed: 10-15 questions per category, timer is per-exam from DB
S.qCount = 10;
S.secPerQ = 60; // default, overridden per question from DB

function updatePreview(){
  const MAX_PER_CAT=15;
  const maxAvail=S.exams.reduce((sum,k)=>{
    const all=[...DB[k].easy,...DB[k].mid,...DB[k].hard];
    return sum+Math.min(all.length,MAX_PER_CAT);
  },0);
  document.getElementById('pv-exams').textContent=S.exams.length
    ? S.exams.map(k=>DB[k].icon+' '+DB[k].name+' ('+DB[k].timer+'s)').join(' ¬∑ ')
    : 'None';
  document.getElementById('pv-count').textContent=S.exams.length
    ? 'Up to 15 per category ('+maxAvail+' available)'
    : 'Up to 15 per category';
}

document.getElementById('btn-reset-setup').addEventListener('click',()=>{
  S.exams=[];
  document.querySelectorAll('.exam-card').forEach(c=>c.classList.remove('selected'));
  document.getElementById('btn-start-quiz').disabled=true;
  updatePreview();
});

document.getElementById('btn-start-quiz').addEventListener('click',()=>{
  buildQuestions();
  initQuiz();
  show('s-quiz');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUILD QUESTIONS ‚Äî randomise correct position
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildQuestions(){
  const POOLS=['very_easy','easy','mid','hard'];
  S.pools={very_easy:[],easy:[],mid:[],hard:[]};
  S.usedQs={very_easy:new Set(),easy:new Set(),mid:new Set(),hard:new Set()};
  S.exams.forEach(key=>{
    POOLS.forEach(d=>{
      (DB[key][d]||[]).forEach(q=>{
        S.pools[d].push({...q, examKey:key});
      });
    });
  });
  POOLS.forEach(d=>S.pools[d].sort(()=>Math.random()-.5));

  // Adaptive state ‚Äî start at given level or default Easy (1)
  S.level=(typeof S._continueLevel==='number')?S._continueLevel:1;
  S._continueLevel=null;
  S.recentAns=[];
  S.diffHistory=[];
  S.diff=LEVEL_TO_POOL[S.level]||'easy';
  S.totalQs=15;

  // Pick ONLY the first question ‚Äî rest picked dynamically after each answer
  S.qs=[];
  const first=pickAdaptiveQ();
  if(first){ S.qs.push(shuffleQ(first)); S.diffHistory.push(S.level); }

  S.idx=0; S.score=0; S.streak=0; S.bestStreak=0;
  S.ans=new Array(S.totalQs).fill(null);
  S.timeTaken=new Array(S.totalQs).fill(0);
}

function pickAdaptiveQ(){
  const pool=LEVEL_TO_POOL[S.level];
  // Try current pool
  for(let i=0;i<S.pools[pool].length;i++){
    if(!S.usedQs[pool].has(i)){
      S.usedQs[pool].add(i);
      return {...S.pools[pool][i], _diff:S.level};
    }
  }
  // Fallback: try adjacent pools
  const adj=[];
  if(S.level>0) adj.push(LEVEL_TO_POOL[S.level-1]);
  if(S.level<4) adj.push(LEVEL_TO_POOL[S.level+1]);
  for(const p of [...new Set(adj)]){
    for(let i=0;i<S.pools[p].length;i++){
      if(!S.usedQs[p].has(i)){
        S.usedQs[p].add(i);
        return {...S.pools[p][i], _diff:S.level};
      }
    }
  }
  return null;
}

// Pick next question at CURRENT difficulty and append to queue
function pickNextQ(){
  if(S.qs.length>=S.totalQs) return;
  const q=pickAdaptiveQ();
  if(q){
    S.qs.push(shuffleQ(q));
    S.diffHistory.push(S.level);
  }
}

function checkLevelChange(){
  const len=S.recentAns.length;
  if(len<3) return;

  const last5=S.recentAns.slice(-5);
  const last3=S.recentAns.slice(-3);
  const correct5=last5.filter(Boolean).length;
  const wrong3=last3.filter(x=>!x).length;

  // Level UP: 4+ correct out of last 4-5 answers
  if(len>=4 && correct5>=4 && S.level<4){
    S.level++;
    S.recentAns=[];
    showLevelToast(true);
    updateDiffBadge();
    updateQuestionDiffTag();
  }
  // Level DOWN: 3 consecutive wrong ‚Üí drop immediately
  else if(wrong3===3 && S.level>0){
    S.level--;
    S.recentAns=[];
    showLevelToast(false);
    updateDiffBadge();
    updateQuestionDiffTag();
  }
}

// Instantly update the difficulty tag on the current question card
function updateQuestionDiffTag(){
  const dtag=document.getElementById('qt-diff');
  if(!dtag) return;
  dtag.textContent=LEVEL_ICONS[S.level]+' '+LEVEL_NAMES[S.level];
  dtag.style.cssText='color:'+LEVEL_COLORS[S.level]+';border-color:'+LEVEL_COLORS[S.level];
  // Animate the tag to draw attention
  dtag.style.transition='none';
  dtag.style.transform='scale(1.3)';
  setTimeout(()=>{
    dtag.style.transition='transform 0.3s ease';
    dtag.style.transform='scale(1)';
  },50);
}

function shuffleQ(q){
  const opts=[...q.o];
  const correctVals=q.c.map(i=>opts[i]);
  const shuffled=[...opts].sort(()=>Math.random()-.5);
  const newCorrect=correctVals.map(v=>shuffled.indexOf(v));
  return {...q, o:shuffled, c:newCorrect};
}

function showLevelToast(isUp){
  const t=document.getElementById('level-toast');
  const label=LEVEL_ICONS[S.level]+' '+LEVEL_NAMES[S.level];
  const upMsgs=[
    'You\'re on fire! üî•','Brilliant mind! üß†','Unstoppable! üí™',
    'Keep crushing it! üöÄ','Amazing streak! ‚≠ê','You\'re a genius! üéØ',
    'Next level unlocked! üèÜ','Superb performance! üëè','Champion mode! ü•á',
    'You make it look easy! üòé'
  ];
  const downMsgs=[
    'Stay strong, you got this! üí™','Don\'t give up! üåü','Keep trying, champ! üéØ',
    'Every mistake is a lesson! üìö','You\'ll bounce back! üîÑ','Focus and conquer! üß†',
    'Practice makes perfect! ‚ú®','Believe in yourself! üí´','Take a breath & try again! üåä',
    'Winners never quit! üèÖ'
  ];
  const msgs=isUp?upMsgs:downMsgs;
  const motivation=msgs[Math.floor(Math.random()*msgs.length)];
  const color=LEVEL_COLORS[S.level];
  document.getElementById('lvl-msg').innerHTML=
    '<span style="font-size:1.1rem">'+(isUp?'‚¨ÜÔ∏è Level Up':'‚¨áÔ∏è Level Down')+'</span>'+
    '<br><span style="font-size:1rem;color:'+color+'">‚Üí '+label+'</span>'+
    '<br><span style="font-size:.78rem;font-weight:600;opacity:.85">'+motivation+'</span>';
  t.className='level-toast '+(isUp?'up':'down')+' show';
  setTimeout(()=>t.classList.remove('show'),2800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QUIZ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initQuiz(){
  // exam pill
  document.getElementById('qh-exam').textContent=S.exams.map(k=>DB[k].icon+' '+DB[k].name).join(' ¬∑ ');
  updateDiffBadge();
  updateSidebar();
  loadQ();
}

function loadQ(){
  S.answered=false; S.selectedOpts=new Set();
  const q=S.qs[S.idx];
  const ex=DB[q.examKey];
  const n=S.totalQs;

  document.getElementById('q-num-lbl').textContent=`Question ${S.idx+1} of ${n}`;
  document.getElementById('q-text').textContent=q.q;

  const dtag=document.getElementById('qt-diff');
  const qlvl=S.qs[S.idx]._diff!=null?S.qs[S.idx]._diff:S.level;
  dtag.textContent=LEVEL_ICONS[qlvl]+' '+LEVEL_NAMES[qlvl];
  dtag.style.cssText='color:'+LEVEL_COLORS[qlvl]+';border-color:'+LEVEL_COLORS[qlvl];
  dtag.className='qtag qtag-diff';
  updateDiffBadge();
  document.getElementById('qt-cat').textContent=ex.icon+' '+ex.name;
  // Update timer chip in header to show this exam's timer
  const examTimer=ex.timer||60;
  const timerChip=document.getElementById('qh-timer');
  if(timerChip) timerChip.textContent='‚è± '+examTimer+'s/Q';
  document.getElementById('t-num').textContent=examTimer;
  document.getElementById('timer-box').className='timer-box';
  document.getElementById('tbar-fill').style.width='100%';
  document.getElementById('tbar-fill').className='tbar-fill';

  // multi-answer note
  const mn=document.getElementById('multi-note');
  mn.style.display=(q.multi)?'inline-flex':'none';

  // score display
  document.getElementById('qs-pts').textContent=S.score;
  document.getElementById('hud-pts').textContent='‚ö° '+S.score+' pts';
  const stkBox=document.getElementById('qs-stk-box');
  if(S.streak>=2){ stkBox.classList.remove('hidden'); document.getElementById('qs-stk').textContent=S.streak; }
  else stkBox.classList.add('hidden');

  updateDots();

  // nav
  document.getElementById('btn-qback').disabled=(S.idx===0);
  const isLast=S.idx===n-1;
  document.getElementById('btn-qnext').textContent=isLast?'Finish ‚úì':'Next ‚Üí';

  if(S.ans[S.idx]!==null){
    const prev=S.ans[S.idx];
    if(prev.timedOut || prev.skipped){
      renderOptsLocked(S.qs[S.idx], false);
      hideFeedback();
      hideExplain();
    } else {
      renderOpts(S.qs[S.idx],true);
      showFeedback(prev);
      showExplain(S.qs[S.idx].e);
    }
    document.getElementById('btn-qnext').disabled=false;
    document.getElementById('btn-skip').disabled=true;
    document.getElementById('btn-check').style.display='none';
    stopTimer();
  } else {
    renderOpts(q,false);
    hideFeedback();
    hideExplain();
    document.getElementById('btn-qnext').disabled=true;
    document.getElementById('btn-skip').disabled=false;
    document.getElementById('btn-check').style.display='';
    document.getElementById('btn-check').disabled=true;
    startTimer();
  }
}

function jumpTo(i){
  if(i===S.idx || i>=S.qs.length) return;
  stopTimer(); S.idx=i; loadQ();
}

function updateDiffBadge(){
  const hd=document.getElementById('qh-diff');
  if(hd){
    hd.textContent=LEVEL_ICONS[S.level]+' '+LEVEL_NAMES[S.level];
    hd.style.color=LEVEL_COLORS[S.level];
    hd.style.textShadow='0 0 8px '+LEVEL_COLORS[S.level]+'66';
    // Pulse animation
    hd.style.transition='none';
    hd.style.transform='scale(1.25)';
    setTimeout(()=>{
      hd.style.transition='transform 0.3s ease';
      hd.style.transform='scale(1)';
    },50);
  }
}

function updateDots(){ updateSidebar(); }

function updateSidebar(){
  const answered=S.ans.filter(a=>a!==null);
  const correct=answered.filter(a=>a&&a.ok).length;
  const total=answered.length;
  const accPct=total?Math.round((correct/total)*100):0;

  // Stats
  document.getElementById('sb-pts').textContent=S.score;
  const accEl=document.getElementById('sb-acc');
  accEl.textContent=accPct+'%';
  accEl.className='sb-stat-val '+(accPct>=70?'acc-green':accPct>=40?'acc-amber':'acc-red');
  document.getElementById('sb-streak').textContent=S.streak;

  // Avg time
  const times=S.timeTaken.filter(t=>t!=null);
  const avgT=times.length?Math.round(times.reduce((a,b)=>a+b,0)/times.length):0;
  document.getElementById('sb-avgtime').textContent=avgT+'s';

  // Progress
  const progPct=Math.round((total/S.totalQs)*100);
  document.getElementById('sb-prog-ans').textContent=total+' answered';
  document.getElementById('sb-prog-pct').textContent=progPct+'%';
  document.getElementById('sb-prog-bar').style.width=progPct+'%';

  // Question Sets ‚Äî group into sets of 5, show per-question difficulty
  const sets=[];
  for(let i=0;i<S.totalQs;i+=5){
    const chunk=[];
    for(let j=i;j<Math.min(i+5,S.totalQs);j++) chunk.push(j);
    const setCorrect=chunk.filter(j=>S.ans[j]&&S.ans[j].ok).length;
    sets.push({start:i, indices:chunk, correct:setCorrect});
  }

  const qsetsEl=document.getElementById('sb-qsets');
  qsetsEl.innerHTML=sets.map((set,si)=>{
    const boxes=set.indices.map(j=>{
      let cls='sb-qbox';
      let txt=j+1;
      const qLvl=S.diffHistory[j];
      const hasLevel=(qLvl!=null);
      let borderColor='';
      if(j===S.idx){ cls+=' cur'; }
      else if(S.ans[j]){
        if(S.ans[j].skipped) { cls+=' skip'; txt='‚Äî'; }
        else if(S.ans[j].ok) { cls+=' ok'; txt='‚úì'; }
        else { cls+=' bad'; txt='‚úó'; }
      }
      if(hasLevel) borderColor='border-color:'+LEVEL_COLORS[qLvl];
      return `<div class="${cls}" data-qi="${j}" style="${borderColor}">${txt}</div>`;
    }).join('');
    return `<div class="sb-qset">
      <div class="sb-qset-header">
        <div class="sb-qset-label">Set ${si+1}</div>
        <div class="sb-qset-count">${set.correct}/${set.indices.length}</div>
      </div>
      <div class="sb-qset-grid">${boxes}</div>
    </div>`;
  }).join('');

  // Click handlers for question boxes
  qsetsEl.querySelectorAll('.sb-qbox').forEach(b=>{
    b.addEventListener('click',()=>jumpTo(+b.dataset.qi));
  });

  // Difficulty Journey
  const jEl=document.getElementById('sb-journey');
  // Group consecutive questions with same difficulty
  const groups=[];
  let curGroup=null;
  for(let i=0;i<S.diffHistory.length;i++){
    const lvl=S.diffHistory[i];
    if(!curGroup||curGroup.level!==lvl){
      curGroup={level:lvl, start:i+1, end:i+1, correct:0, total:0};
      groups.push(curGroup);
    } else {
      curGroup.end=i+1;
    }
    curGroup.total++;
    if(S.ans[i]&&S.ans[i].ok) curGroup.correct++;
  }
  jEl.innerHTML=groups.map((g,i)=>{
    const color=LEVEL_COLORS[g.level];
    const name=LEVEL_NAMES[g.level];
    const icon=LEVEL_ICONS[g.level];
    const pts=g.correct*LEVEL_POINTS[g.level];
    return `<div class="sb-jrow">
      <div class="sb-jrow-num">${i+1}</div>
      <div class="sb-jrow-diff" style="color:${color}">${icon} ${name}</div>
      <div class="sb-jrow-score">${g.correct}/${g.total} ¬∑ ${pts}pts</div>
    </div>`;
  }).join('');
  if(!jEl.innerHTML) jEl.innerHTML='<div style="font-size:.7rem;color:var(--sub)">Starting...</div>';
}

// ‚îÄ‚îÄ Render Options ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// renderOptsLocked: lock options, showCorrect=true shows green highlight, false = plain lock
function renderOptsLocked(q, showCorrect){
  const container=document.getElementById('opts');
  container.innerHTML='';
  const KEYS=['A','B','C','D'];
  const a=S.ans[S.idx];
  q.o.forEach((opt,i)=>{
    const btn=document.createElement('div');
    btn.className='opt locked';
    btn.innerHTML=`<div class="opt-key">${KEYS[i]}</div><div class="opt-txt">${opt}</div><div class="opt-ic"></div>`;
    if(showCorrect && a && !a.skipped && !a.timedOut){
      const isCorrect=q.c.includes(i);
      const wasSelected=a.selected&&a.selected.includes(i);
      if(isCorrect){ btn.classList.add('correct'); btn.querySelector('.opt-ic').textContent='‚úì'; }
      else if(wasSelected&&!isCorrect){ btn.classList.add('wrong'); btn.querySelector('.opt-ic').textContent='‚úó'; }
    }
    container.appendChild(btn);
  });
}

function renderOpts(q, locked){
  if(locked){ renderOptsLocked(q, true); return; }
  // Interactive (unanswered) render
  const container=document.getElementById('opts');
  container.innerHTML='';
  const KEYS=['A','B','C','D'];
  q.o.forEach((opt,i)=>{
    const btn=document.createElement('div');
    btn.className='opt';
    btn.innerHTML=`<div class="opt-key">${KEYS[i]}</div><div class="opt-txt">${opt}</div><div class="opt-ic"></div>`;
    btn.addEventListener('click',()=>selectOpt(i,btn,q));
    container.appendChild(btn);
  });
}

function selectOpt(i,btn,q){
  if(S.answered) return;
  if(q.multi){
    // multi: toggle selection
    if(S.selectedOpts.has(i)){
      S.selectedOpts.delete(i);
      btn.classList.remove('sel');
    } else {
      S.selectedOpts.add(i);
      btn.classList.add('sel');
    }
    document.getElementById('btn-check').disabled=(S.selectedOpts.size===0);
  } else {
    // single: select only (don't auto-submit), highlight selected
    document.querySelectorAll('#opts .opt').forEach(o=>o.classList.remove('sel'));
    S.selectedOpts=new Set([i]);
    btn.classList.add('sel');
    document.getElementById('btn-check').disabled=false;
  }
}

// Check button ‚Äî confirm selected answer
document.getElementById('btn-check').addEventListener('click',()=>{
  const q=S.qs[S.idx];
  if(S.answered||S.selectedOpts.size===0) return;
  submitAnswer(q);
});

function submitAnswer(q){
  if(S.answered) return;
  S.answered=true;
  stopTimer();
  if(S.secPerQ>0){
    const elapsed=Math.max(0,S.secPerQ-S.timeLeft);
    S.timeTaken[S.idx]=elapsed;
  }
  const selected=[...S.selectedOpts];
  const ok=q.c.length===selected.length && q.c.every(ci=>selected.includes(ci));
  let pts=0;
  if(ok){
    const ratio=S.secPerQ>0?S.timeLeft/S.secPerQ:1;
    const base=LEVEL_POINTS[q._diff!=null?q._diff:S.level];
    pts=Math.max(20,Math.round(ratio*base));
    S.score+=pts; S.streak++; S.bestStreak=Math.max(S.bestStreak,S.streak);
    if(S.streak>=3) showStreakToast(S.streak);
  } else {
    S.streak=0;
  }
  S.ans[S.idx]={ok,selected,correct:q.c,pts,skipped:false,diff:q._diff};
  // Adaptive: track and check
  S.recentAns.push(ok);
  if(S.recentAns.length>5) S.recentAns.shift();
  checkLevelChange();
  // reveal options
  renderOpts(q,true);
  showFeedback(S.ans[S.idx],q,pts);
  showExplain(q.e);
  document.getElementById('btn-qnext').disabled=false;
  document.getElementById('btn-skip').disabled=true;
  document.getElementById('btn-check').style.display='none';
  const isLast=S.idx>=S.totalQs-1;
  document.getElementById('btn-qnext').textContent=isLast?'Finish ‚úì':'Next ‚Üí';
  document.getElementById('qs-pts').textContent=S.score;
  document.getElementById('hud-pts').textContent='‚ö° '+S.score+' pts';
  updateDots();
}

// ‚îÄ‚îÄ SKIP ‚Äî no answer shown, just move ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('btn-skip').addEventListener('click',()=>{
  if(S.answered) return;
  stopTimer();
  S.timeTaken[S.idx]=0;
  S.ans[S.idx]={ok:false,selected:[],correct:S.qs[S.idx].c,pts:0,skipped:true,diff:S.qs[S.idx]._diff};
  S.streak=0;
  S.recentAns.push(false);
  if(S.recentAns.length>5) S.recentAns.shift();
  checkLevelChange();
  // Lock options silently ‚Äî no correct answer shown
  renderOptsLocked(S.qs[S.idx], false);
  hideFeedback(); hideExplain();
  document.getElementById('btn-skip').disabled=true;
  document.getElementById('btn-check').style.display='none';
  updateDots();
  // Auto-move to next (show set overlay at set boundary)
  setTimeout(()=>{
    if((S.idx+1)%5===0 && S.idx<S.totalQs-1){
      showSetOverlay();
    } else if(S.idx<S.totalQs-1){
      pickNextQ(); S.idx++; loadQ();
    } else finishQuiz();
  },200);
});

// Back / Next
document.getElementById('btn-qback').addEventListener('click',()=>{
  if(S.idx===0) return;
  stopTimer(); S.idx--; loadQ();
});

document.getElementById('btn-qnext').addEventListener('click',()=>{
  if(S.idx<S.totalQs-1){
    stopTimer();
    // Check if this is the last question in a set of 5 (show set overlay)
    if((S.idx+1)%5===0 && S.ans[S.idx]!==null){
      showSetOverlay();
    } else {
      pickNextQ(); S.idx++; loadQ();
    }
  } else finishQuiz();
});

// ‚îÄ‚îÄ SET COMPLETION OVERLAY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SET_TITLES=[
  {title:'Charging Up!',desc:'Each question you attempt builds your mental database. You\'re training your brain like an athlete trains their body!'},
  {title:'Warming Up!',desc:'Your brain is getting into the zone. The more you practice, the sharper you become!'},
  {title:'Building Momentum!',desc:'You\'re stacking knowledge brick by brick. Every answer strengthens your foundation!'},
  {title:'Powering Through!',desc:'Mental stamina is your superpower. Keep pushing your limits!'},
  {title:'Leveling Up!',desc:'You\'re evolving with every question. Champions are made through consistent effort!'},
  {title:'Rising Strong!',desc:'Every challenge you face makes you stronger. Keep climbing!'},
  {title:'Knowledge Unlocked!',desc:'Your brain just grew a little bigger. Keep feeding it with more questions!'},
  {title:'Brain Boost!',desc:'Neurons are firing on all cylinders. You\'re in the learning zone!'},
  {title:'On A Roll!',desc:'Success is the sum of small efforts repeated consistently. You\'re proving it!'},
  {title:'Milestone Reached!',desc:'Every set completed is a step closer to mastery. You\'re doing amazing!'},
];

const SET_QUOTES=[
  {text:'It\'s okay to be a work in progress. Progress is the goal.',author:'Unknown'},
  {text:'The expert in anything was once a beginner.',author:'Helen Hayes'},
  {text:'Education is the most powerful weapon to change the world.',author:'Nelson Mandela'},
  {text:'The beautiful thing about learning is that no one can take it away from you.',author:'B.B. King'},
  {text:'Success is not final, failure is not fatal: it is the courage to continue that counts.',author:'Winston Churchill'},
  {text:'The only way to do great work is to love what you do.',author:'Steve Jobs'},
  {text:'Knowledge is power. Information is liberating.',author:'Kofi Annan'},
  {text:'Live as if you were to die tomorrow. Learn as if you were to live forever.',author:'Mahatma Gandhi'},
  {text:'The mind is not a vessel to be filled, but a fire to be kindled.',author:'Plutarch'},
  {text:'An investment in knowledge pays the best interest.',author:'Benjamin Franklin'},
  {text:'The roots of education are bitter, but the fruit is sweet.',author:'Aristotle'},
  {text:'Tell me and I forget, teach me and I remember, involve me and I learn.',author:'Benjamin Franklin'},
  {text:'The more that you read, the more things you will know.',author:'Dr. Seuss'},
  {text:'Intelligence plus character ‚Äî that is the goal of true education.',author:'Martin Luther King Jr.'},
  {text:'Learning never exhausts the mind.',author:'Leonardo da Vinci'},
];

function showSetOverlay(){
  const setNum=Math.floor(S.idx/5);
  const start=setNum*5;
  const end=Math.min(start+5,S.totalQs);

  // Calculate set stats
  let setCorrect=0, setPts=0;
  for(let i=start;i<end;i++){
    if(S.ans[i]&&S.ans[i].ok){ setCorrect++; setPts+=S.ans[i].pts; }
  }
  const setTotal=end-start;
  const setAcc=Math.round((setCorrect/setTotal)*100);

  // Pick motivational content
  const ti=SET_TITLES[setNum%SET_TITLES.length];
  const qi=SET_QUOTES[Math.floor(Math.random()*SET_QUOTES.length)];

  document.getElementById('set-title').textContent=ti.title;
  document.getElementById('set-desc').textContent=ti.desc;
  document.getElementById('set-correct').textContent=setCorrect+'/'+setTotal;
  document.getElementById('set-pts').textContent=setPts;
  const accEl=document.getElementById('set-acc');
  accEl.textContent=setAcc+'%';
  accEl.className='set-stat-val '+(setAcc>=70?'green':setAcc>=40?'amber':'red');

  document.getElementById('set-quote-text').textContent=qi.text;
  document.getElementById('set-quote-author').textContent='‚Äî '+qi.author;

  // Difficulty flow: show start ‚Üí current level for this set
  const startLvl=S.diffHistory[start]!=null?S.diffHistory[start]:S.level;
  const endLvl=S.level;
  const flow=document.getElementById('set-diff-flow');
  if(startLvl!==endLvl){
    flow.innerHTML=`<span class="set-diff-badge" style="color:${LEVEL_COLORS[startLvl]};border-color:${LEVEL_COLORS[startLvl]}">${LEVEL_NAMES[startLvl].toUpperCase()}</span>
      <span class="set-diff-arrow">‚Üí</span>
      <span class="set-diff-badge" style="color:${LEVEL_COLORS[endLvl]};border-color:${LEVEL_COLORS[endLvl]}">${LEVEL_NAMES[endLvl].toUpperCase()}</span>`;
  } else {
    flow.innerHTML=`<span class="set-diff-badge" style="color:${LEVEL_COLORS[endLvl]};border-color:${LEVEL_COLORS[endLvl]}">‚óè ${LEVEL_NAMES[endLvl].toUpperCase()}</span>`;
  }

  // Update continue button text for last set
  const isLastSet=(S.idx>=S.totalQs-1);
  document.getElementById('btn-continue').textContent=isLastSet?'View Results ‚Üí':'Continue Next Set ‚Üí';

  document.getElementById('set-overlay').classList.add('show');
}

document.getElementById('btn-continue').addEventListener('click',()=>{
  document.getElementById('set-overlay').classList.remove('show');
  if(S.idx>=S.totalQs-1){
    finishQuiz();
  } else {
    pickNextQ(); S.idx++; loadQ();
  }
});

// ‚îÄ‚îÄ EXIT ‚Äî confirm and return to dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('btn-exit').addEventListener('click',()=>{
  if(!confirm('Are you sure you want to exit the quiz? Progress will be lost.')) return;
  stopTimer();
  show('s-dashboard');
  renderDashboard();
});

// ‚îÄ‚îÄ TIMER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Get the timer for the current question's exam category
function getCurrentTimer(){
  const q=S.qs[S.idx];
  if(!q) return 60;
  return DB[q.examKey]?.timer || 60;
}

function startTimer(){
  stopTimer();
  S.secPerQ=getCurrentTimer(); // set from exam's timer config
  S.timeLeft=S.secPerQ;
  window._qStart=Date.now();
  renderTimer();
  S.timerId=setInterval(()=>{
    S.timeLeft--;
    renderTimer();
    if(S.timeLeft<=0){ clearInterval(S.timerId); autoTimeout(); }
  },1000);
}
function stopTimer(){ clearInterval(S.timerId); }
function renderTimer(){
  if(S.secPerQ===0) return;
  const pct=S.timeLeft/S.secPerQ;
  const fill=document.getElementById('tbar-fill');
  const box=document.getElementById('timer-box');
  fill.style.width=(pct*100)+'%';
  document.getElementById('t-num').textContent=S.timeLeft;
  const cls=pct<=0.3?'danger':pct<=0.5?'warn':'';
  fill.className='tbar-fill'+(cls?' '+cls:'');
  box.className='timer-box'+(cls?' '+cls:'');
}
function autoTimeout(){
  if(S.answered) return;
  S.answered=true;
  const q=S.qs[S.idx];
  // Mark as timed-out (no correct reveal, no answer shown)
  S.ans[S.idx]={ok:false,selected:[],correct:q.c,pts:0,skipped:false,timedOut:true,diff:q._diff};
  S.streak=0;
  S.recentAns.push(false);
  if(S.recentAns.length>5) S.recentAns.shift();
  checkLevelChange();
  // Lock options but DO NOT highlight correct answer
  renderOptsLocked(q, false);
  document.getElementById('btn-check').style.display='none';
  document.getElementById('btn-skip').disabled=true;
  updateDots();
  showFeedback(S.ans[S.idx],q,0);
  hideExplain();
  // Auto-move after showing feedback
  const isLast=S.idx>=S.totalQs-1;
  document.getElementById('timer-box').style.background='rgba(255,77,109,.25)';
  setTimeout(()=>{
    document.getElementById('timer-box').style.background='';
    if(isLast){ finishQuiz(); }
    else if((S.idx+1)%5===0){ showSetOverlay(); }
    else { pickNextQ(); S.idx++; loadQ(); }
  },1500);
}

// ‚îÄ‚îÄ FEEDBACK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CORRECT_MSGS=[
  'Brilliant! You nailed it! üéØ','Awesome! Keep rocking! üöÄ','Superb answer! üåü','You\'re on fire! üî•',
  'Genius move! üß†','Spot on! Well done! üëè','Excellent! That\'s the way! ‚≠ê','Perfect pick! üíé',
  'Sharp mind! Keep going! ‚ö°','Outstanding! You know this! üí™','Crushed it! Amazing! üèÜ','Bravo! Nailed it! üéâ',
  'Right on target! üéØ','Impressive! Keep it up! üåà','Smart answer! ü¶â','You make it look easy! üòé',
  'Textbook perfect! üìñ','Knowledge is power! üí°','Top-notch answer! ü•á','You\'re unstoppable! ü¶Å'
];
const WRONG_MSGS=[
  'Not quite ‚Äî you\'ll get the next one! üí™','Close! Keep pushing forward! üèÉ','Mistakes teach us! Learn & grow! üå±',
  'Don\'t worry, keep trying! üåü','It\'s okay! Every error is a lesson! üìö','Chin up! You\'re still in the game! üéÆ',
  'Almost there! Stay focused! üéØ','Tough one! You\'ll crack it next time! üîì','Keep going ‚Äî persistence wins! üèÖ',
  'No worries! Great learners make mistakes! üß†','That was tricky! Stay strong! üíé','Not this time ‚Äî but you\'re improving! üìà',
  'Hang in there! Success is near! üåÖ','Shake it off and move forward! üîÑ','One step back, two steps forward! üë£',
  'Stay confident! You\'re learning! ‚ú®','Keep your head up! Champions bounce back! üèÜ','Wrong today, right tomorrow! üåà',
  'It\'s a marathon, not a sprint! üèÅ','Review this one later ‚Äî you\'ll master it! üîë'
];
const TIMEOUT_MSGS=[
  'Time flies! Be quicker next time! ‚è∞','Almost! A little faster and you\'ll get it! üèÉ',
  'Clock ran out ‚Äî trust your instincts! ‚ö°','Don\'t overthink ‚Äî go with your gut! üéØ',
  'Speed comes with practice! Keep going! üî•','Tick tock! Read faster next time! üìñ',
  'Time\'s up ‚Äî but don\'t let it stop you! üí™','Quicker decisions come with practice! üß†',
  'Racing against time ‚Äî you\'ll improve! üèéÔ∏è','Time management is a skill ‚Äî you\'re building it! ‚è≥'
];
function showFeedback(a,q,pts){
  const fb=document.getElementById('feedback');
  if(!a||a.skipped){ fb.className='feedback'; return; }
  const rnd=arr=>arr[Math.floor(Math.random()*arr.length)];
  if(a.timedOut){
    fb.className='feedback bad show';
    fb.innerHTML=`<div class="fb-icon">‚è±Ô∏è</div><div class="fb-body"><strong>Time\'s Up!</strong><br><span style="font-size:.82rem;opacity:.85">${rnd(TIMEOUT_MSGS)}</span></div>`;
    return;
  }
  if(a.ok){
    fb.className='feedback ok show';
    fb.innerHTML=`<div class="fb-icon">‚úÖ</div><div class="fb-body"><strong>Correct! +${a.pts} pts</strong>${S.streak>=3?' üî• '+S.streak+'√ó Streak!':''}<br><span style="font-size:.82rem;opacity:.85">${rnd(CORRECT_MSGS)}</span></div>`;
  } else {
    const q2=S.qs[S.idx];
    const correctStr=a.correct.map(ci=>q2.o[ci]).join(' / ');
    fb.className='feedback bad show';
    fb.innerHTML=`<div class="fb-icon">‚ùå</div><div class="fb-body"><strong>Wrong!</strong> Correct: <strong>${correctStr}</strong><br><span style="font-size:.82rem;opacity:.85">${rnd(WRONG_MSGS)}</span></div>`;
  }
}
function hideFeedback(){ document.getElementById('feedback').className='feedback'; }
function showExplain(text){
  const eb=document.getElementById('explain-box');
  document.getElementById('explain-text').textContent=text;
  eb.classList.add('show');
}
function hideExplain(){ document.getElementById('explain-box').classList.remove('show'); }

// ‚îÄ‚îÄ STREAK TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showStreakToast(n){
  const t=document.getElementById('streak-toast');
  const msgs=[
    '','',' Nice start!',        // 2
    ' Keep it up!',              // 3
    ' You\'re on fire!',         // 4
    ' Brilliant mind!',          // 5
    ' Unstoppable force!',       // 6
    ' Absolute beast!',          // 7
    ' Genius level!',            // 8
    ' You\'re a machine!',       // 9
    ' Perfect 10! Flawless!',    // 10
    ' Beyond amazing!',          // 11
    ' Einstein who?!',           // 12
    ' Record breaker!',          // 13
    ' Hall of fame!',            // 14
    ' Legendary status!',        // 15
    ' One in a million!',        // 16
    ' Unreal talent!',           // 17
    ' God mode activated!',      // 18
    ' Supreme champion!',        // 19
    ' The GOAT! Untouchable!',   // 20+
  ];
  const msg=msgs[Math.min(n,20)]||'';
  document.getElementById('stk-msg').textContent=n+'√ó Streak! üî•'+msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2200);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FINISH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function finishQuiz(){
  stopTimer();
  // fill any unanswered
  S.qs.forEach((_,i)=>{
    if(!S.ans[i]) S.ans[i]={ok:false,selected:[],correct:S.qs[i].c,pts:0,skipped:true};
  });

  const n=S.qs.length;
  const answers=S.ans.slice(0,n);
  const cor=answers.filter(a=>a&&a.ok).length;
  const wrg=answers.filter(a=>a&&!a.ok&&!a.skipped).length;
  const skp=answers.filter(a=>!a||a.skipped).length;
  const acc=Math.round((cor/n)*100);

  // save to user history
  const ud=USERS[CU];
  ud.points=(ud.points||0)+S.score;
  ud.bestStreak=Math.max(ud.bestStreak||0,S.bestStreak);
  const rec={
    exam:S.exams[0]||'mixed', exams:S.exams,
    diff:S.diff, count:n, correct:cor, wrong:wrg, skipped:skp,
    acc, pts:S.score,
    date:new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'}),
    perExam:{},
    // Save questions & answers for review
    questions:S.qs.map(q=>({q:q.q,o:q.o,c:q.c,e:q.e,examKey:q.examKey,_diff:q._diff})),
    answers:S.ans.map(a=>a?{ok:a.ok,selected:a.selected,correct:a.correct,pts:a.pts,skipped:a.skipped,timedOut:a.timedOut}:null),
    diffHistory:[...S.diffHistory]
  };
  // per-exam breakdown
  S.exams.forEach(k=>{
    const ea=S.ans.filter((_,i)=>S.qs[i].examKey===k);
    const ec=ea.filter(a=>a.ok).length;
    rec.perExam[k]={total:ea.length,correct:ec,acc:ea.length?Math.round(ec/ea.length*100):0};
  });
  ud.history.push(rec);
  saveUsers();
  document.getElementById('hud-pts').textContent='‚ö° '+ud.points+' pts';

  showResults(cor,wrg,skp,acc);
}

function showResults(cor,wrg,skp,acc){
  // hero
  let emoji,title,sub;
  const tips100=[
    'You are a true champion! Nothing can stop you! üåü',
    'Absolute genius! Your preparation is paying off! üß†',
    'You crushed it! Ready for the next challenge? üöÄ',
    'Incredible! You\'ve mastered this topic completely! üëë',
    'Flawless victory! You\'re destined for greatness! üéñÔ∏è',
    'Perfection personified! Take a bow, superstar! üå†',
    'You nailed every single one! What a performance! üíé',
    'Zero mistakes ‚Äî your dedication is unmatched! üèÖ',
    'A perfect score! You\'re truly exam-ready! üìú',
    'Legendary performance! The topper is here! üëè',
    'Wow! Not a single error ‚Äî you\'re unstoppable! ü¶Å',
    'Pure excellence! Your knowledge is outstanding! üî¨',
    'You aced it completely! Time to celebrate! üéä',
    'Mind-blowing! 100% accuracy is no joke! ü§Ø',
    'Supreme mastery! Nothing more to prove! üè∞',
    'Textbook perfect! You\'re an inspiration! üìñ',
    'You made it look effortless! True talent! üé™',
    'Standing ovation for this flawless run! üé≠',
    'Unbreakable! You\'ve conquered this exam! ‚öîÔ∏è',
    'The gold standard! Everyone should learn from you! ü•á'
  ];
  const tips80=[
    'Your hard work is showing ‚Äî almost perfect! üî•',
    'Impressive knowledge! You\'re exam-ready! üíØ',
    'Fantastic result! Just a few more to master! ‚≠ê',
    'You\'re shining bright! Greatness is within reach! ‚ú®',
    'So close to perfection! You\'re nearly there! üéØ',
    'Brilliant performance! Your efforts are paying off! üåü',
    'Outstanding work! A little more polish and you\'ll be perfect! üí™',
    'You\'re in the top league! Keep this momentum going! üöÄ',
    'Superb accuracy! Your knowledge base is strong! üèõÔ∏è',
    'Wonderful score! You\'re among the best! ü•à',
    'Exceptional! Just iron out the small gaps! üîß',
    'You\'re dominating this subject! Keep it up! üëä',
    'Almost there! Victory is just around the corner! üèÅ',
    'Your consistency is remarkable! Stay focused! üéØ',
    'Impressive! You\'re performing like a champion! üèÜ',
    'Rock solid performance! Be proud of yourself! ü™®',
    'You\'re firing on all cylinders! Amazing! üî•',
    'Top-tier score! The finish line is in sight! üèÉ‚Äç‚ôÇÔ∏è',
    'Magnificent! Your preparation strategy is working! üìä',
    'Nearly flawless! Success is your destiny! üåÖ'
  ];
  const tips60=[
    'Good effort! Review the tricky ones and ace it next time! üìù',
    'You\'re on the right track ‚Äî consistency is key! üéØ',
    'Solid foundation! A little more practice and you\'ll soar! ü¶Ö',
    'Nice work! Turn mistakes into strengths! üí™',
    'You\'re getting there! Every quiz makes you smarter! üß†',
    'Above average! Push a little harder for excellence! üìà',
    'Well played! Focus on weak areas and watch yourself grow! üå±',
    'Decent score! You have the potential for much more! üíé',
    'Good start! Revise the wrong ones and retry! üîÑ',
    'You\'re building momentum! Don\'t stop now! üèóÔ∏è',
    'Halfway to mastery! Keep climbing! üßó',
    'Not bad at all! A few more rounds will make you shine! ‚ú®',
    'Your effort is commendable! Success loves persistence! üèÖ',
    'Progress is visible! Keep pushing your limits! üöÄ',
    'You\'re in the growth zone! This is where champions are made! üåø',
    'Steady progress! Review explanations and come back stronger! üìö',
    'You\'ve got the basics down! Time to level up! ‚¨ÜÔ∏è',
    'Nice try! Each attempt sharpens your skills! ‚ö°',
    'You\'re capable of more ‚Äî believe and achieve! üåà',
    'Good foundation! Polish the edges and you\'ll excel! üéì'
  ];
  const tips40=[
    'Don\'t worry ‚Äî every expert was once a beginner! üå±',
    'Progress is progress, no matter how small. Keep pushing! üèÉ',
    'Study the explanations ‚Äî they\'re your secret weapon! üîë',
    'Believe in yourself! You\'re learning with every attempt! üìö',
    'Rome wasn\'t built in a day. Keep building! üèõÔ∏è',
    'You\'re planting seeds of knowledge. They will bloom! üåª',
    'Stay curious! Questions are the path to answers! ‚ùì',
    'Don\'t compare your chapter 1 to someone\'s chapter 20! üìñ',
    'Every attempt is a step closer to your goal! üë£',
    'You have the courage to try ‚Äî that\'s half the battle! ‚öîÔ∏è',
    'Knowledge is a journey, not a destination! üõ§Ô∏è',
    'Small progress is still progress. Be proud! üéñÔ∏è',
    'Focus on what you learned, not what you missed! üîç',
    'The expert in anything was once a beginner! üåÖ',
    'Your potential is unlimited. Keep going! üåä',
    'Mistakes are proof that you are trying! ‚úÖ',
    'Review, revise, retry ‚Äî the winning formula! üîÑ',
    'Tough topics need more time. Be patient with yourself! ‚è≥',
    'You\'re braver than you believe and stronger than you seem! ü¶ä',
    'This is just the beginning of your journey! üõ´'
  ];
  const tipsLow=[
    'Failure is the stepping stone to success ‚Äî never give up! üî•',
    'The only real failure is not trying again. You\'ve got this! üí™',
    'Champions are made through practice. Come back stronger! üèÜ',
    'Every wrong answer is a lesson learned. Your time will come! üåà',
    'Fall seven times, stand up eight! You\'re a warrior! ‚öîÔ∏è',
    'Difficult roads lead to beautiful destinations! üèîÔ∏è',
    'It\'s not about how hard you fall ‚Äî it\'s about how you rise! ü¶Ö',
    'Edison failed 1000 times before the light bulb. Keep trying! üí°',
    'Your determination is your greatest strength! üíé',
    'Today\'s struggle is tomorrow\'s strength! üåü',
    'Don\'t let one bad score define you. You\'re more than this! üå†',
    'Winners never quit, and quitters never win! üèÖ',
    'The comeback is always stronger than the setback! üîÑ',
    'Believe you can and you\'re halfway there! üåâ',
    'Success is not final, failure is not fatal ‚Äî courage matters! ü¶Å',
    'Stars can\'t shine without darkness. Keep going! ‚≠ê',
    'You\'re tougher than this challenge. Prove it! ü•ä',
    'Every master was once a disaster. Keep learning! üéì',
    'Pain is temporary, knowledge is forever! üìñ',
    'Your future self will thank you for not giving up today! üôè'
  ];
  const pick=arr=>arr[Math.floor(Math.random()*arr.length)];
  if(acc===100){emoji='üèÜ';title='Perfect Score!';sub=pick(tips100)}
  else if(acc>=80){emoji='üéâ';title='Outstanding!';sub=pick(tips80)}
  else if(acc>=60){emoji='üëç';title='Well Done!';sub=pick(tips60)}
  else if(acc>=40){emoji='üìñ';title='Keep Learning!';sub=pick(tips40)}
  else{emoji='üí™';title='Don\'t Give Up!';sub=pick(tipsLow)}
  document.getElementById('rh-emoji').textContent=emoji;
  document.getElementById('rh-title').innerHTML=`<em>${title}</em>`;
  document.getElementById('rh-sub').textContent=sub;
  document.getElementById('ring-pct').textContent=acc+'%';
  document.getElementById('acc-txt').textContent=acc+'%';
  document.getElementById('r-cor').textContent=cor;
  document.getElementById('r-wrg').textContent=wrg;
  document.getElementById('r-skp').textContent=skp;
  document.getElementById('r-pts').textContent=S.score;

  // Time taken
  const totalSec=S.timeTaken.slice(0,S.qs.length).reduce((a,b)=>a+b,0);
  const mins=Math.floor(totalSec/60);
  const secs=totalSec%60;
  document.getElementById('r-time').textContent=mins+':'+(secs<10?'0':'')+secs;

  // Best streak & level journey
  document.getElementById('r-best-streak').textContent=S.bestStreak;
  const startLvl=S.diffHistory.length?S.diffHistory[0]:1;
  const endLvl=S.level;
  document.getElementById('r-start-lvl').textContent=LEVEL_ICONS[startLvl]+' '+LEVEL_NAMES[startLvl];
  document.getElementById('r-end-lvl').textContent=LEVEL_ICONS[endLvl]+' '+LEVEL_NAMES[endLvl];

  // ring
  const ring=document.getElementById('ring-fg');
  const circ=376.99;
  const col=acc>=80?'var(--green)':acc>=50?'var(--amber)':'var(--red)';
  ring.style.stroke=col;
  ring.style.strokeDashoffset=circ;
  setTimeout(()=>{ ring.style.strokeDashoffset=circ-(circ*acc/100); },300);
  setTimeout(()=>{ document.getElementById('acc-fill').style.width=acc+'%'; },300);

  // breakdown
  const bdList=document.getElementById('bd-list');
  bdList.innerHTML='';
  S.exams.forEach(k=>{
    const ex=DB[k];
    const ea=S.ans.filter((_,i)=>S.qs[i].examKey===k);
    const ec=ea.filter(a=>a.ok).length;
    const ep=ea.length?Math.round(ec/ea.length*100):0;
    const brow=document.createElement('div');
    brow.className='bd-row';
    brow.innerHTML=`<div class="bd-icon">${ex.icon}</div>
      <div class="bd-info">
        <div class="bd-name">${ex.name}</div>
        <div class="bd-bar"><div class="bd-fill" style="width:0%;background:${ep>=80?'var(--green)':ep>=50?'var(--amber)':'var(--red)'}" data-p="${ep}"></div></div>
      </div>
      <div class="bd-score">${ec}/${ea.length} (${ep}%)</div>`;
    bdList.appendChild(brow);
  });
  setTimeout(()=>{ document.querySelectorAll('.bd-fill').forEach(b=>{b.style.transition='width 1.1s cubic-bezier(.4,0,.2,1)';b.style.width=b.dataset.p+'%'}); },400);

  // review
  const rvItems=document.getElementById('rv-items');
  rvItems.innerHTML='';
  S.ans.forEach((a,i)=>{
    const q=S.qs[i];
    const ex=DB[q.examKey];
    const isTimeout=a.timedOut;
    const cls=a.ok?'ok':a.skipped?'skip':isTimeout?'skip':'bad';
    const badge=a.ok?'‚úì Correct':a.skipped?'‚ö° Skipped':isTimeout?'‚è± Time\'s Up':'‚úó Wrong';
    let ansLine='';
    if(a.skipped||isTimeout){
      // No correct answer shown in review for skipped/timed-out
      ansLine=isTimeout?`<span style="color:var(--amber)">Time ran out ‚Äî no answer recorded</span>`:`<span>Skipped ‚Äî no answer recorded</span>`;
    } else if(a.ok){
      ansLine=`Your answer: <span class="ca">${a.selected.map(si=>q.o[si]).join(' / ')}</span>`;
    } else {
      ansLine=`Your: <span class="wa">${a.selected.length?a.selected.map(si=>q.o[si]).join(' / '):'‚Äî'}</span> ‚Üí Correct: <span class="ca">${a.correct.map(ci=>q.o[ci]).join(' / ')}</span>`;
    }
    const rv=document.createElement('div');
    rv.className=`rv ${cls}`;
    const explainHtml=(a.ok||(!a.skipped&&!isTimeout))?`<div class="rv-explain">üí° ${q.e}</div>`:'';
    rv.innerHTML=`<div class="rv-top"><span class="rv-badge">${badge}</span><span class="rv-meta">${ex.icon} ${ex.name} ¬∑ Q${i+1}</span></div>
      <div class="rv-q">${q.q}</div>
      <div class="rv-ans">${ansLine}</div>
      ${explainHtml}`;
    rvItems.appendChild(rv);
  });

  // review toggle
  document.getElementById('rv-hdr').classList.remove('open');
  rvItems.classList.remove('open');

  // Motivational quote on results page
  const RESULT_QUOTES=[
    {text:'Live as if you were to die tomorrow. Learn as if you were to live forever.',author:'Mahatma Gandhi'},
    {text:'The expert in anything was once a beginner.',author:'Helen Hayes'},
    {text:'Education is the most powerful weapon which you can use to change the world.',author:'Nelson Mandela'},
    {text:'The beautiful thing about learning is that no one can take it away from you.',author:'B.B. King'},
    {text:'Success is not final, failure is not fatal: it is the courage to continue that counts.',author:'Winston Churchill'},
    {text:'The only way to do great work is to love what you do.',author:'Steve Jobs'},
    {text:'Knowledge is power. Information is liberating.',author:'Kofi Annan'},
    {text:'The mind is not a vessel to be filled, but a fire to be kindled.',author:'Plutarch'},
    {text:'An investment in knowledge pays the best interest.',author:'Benjamin Franklin'},
    {text:'The roots of education are bitter, but the fruit is sweet.',author:'Aristotle'},
    {text:'Tell me and I forget, teach me and I remember, involve me and I learn.',author:'Benjamin Franklin'},
    {text:'Intelligence plus character ‚Äî that is the goal of true education.',author:'Martin Luther King Jr.'},
    {text:'Learning never exhausts the mind.',author:'Leonardo da Vinci'},
    {text:'The more that you read, the more things you will know. The more that you learn, the more places you\'ll go.',author:'Dr. Seuss'},
    {text:'It does not matter how slowly you go as long as you do not stop.',author:'Confucius'},
    {text:'Believe you can and you\'re halfway there.',author:'Theodore Roosevelt'},
    {text:'The secret of getting ahead is getting started.',author:'Mark Twain'},
    {text:'What we learn with pleasure we never forget.',author:'Alfred Mercier'},
    {text:'The capacity to learn is a gift; the ability to learn is a skill; the willingness to learn is a choice.',author:'Brian Herbert'},
    {text:'Every accomplishment starts with the decision to try.',author:'John F. Kennedy'},
  ];
  const rq=RESULT_QUOTES[Math.floor(Math.random()*RESULT_QUOTES.length)];
  document.getElementById('rq-text').textContent=rq.text;
  document.getElementById('rq-author').textContent='‚Äî '+rq.author;

  if(acc>=70) spawnConfetti();
  show('s-result');
}

document.getElementById('rv-hdr').addEventListener('click',()=>{
  document.getElementById('rv-hdr').classList.toggle('open');
  document.getElementById('rv-items').classList.toggle('open');
});

// Continue Next ‚Äî new questions, same exam, keep difficulty level
document.getElementById('ra-retry').addEventListener('click',()=>{
  S._continueLevel=S.level;
  buildQuestions(); initQuiz(); show('s-quiz');
});
// Retry ‚Äî replay the exact same questions
document.getElementById('ra-retryexam').addEventListener('click',()=>{
  // Reset answers but keep same questions
  S.ans=new Array(S.totalQs).fill(null);
  S.score=0; S.streak=0; S.bestStreak=0;
  S.timeTaken=new Array(S.totalQs).fill(0);
  S.recentAns=[]; S.level=1;
  S.diffHistory=S.diffHistory.map(()=>S.level);
  S.idx=0;
  initQuiz();
  show('s-quiz');
});
document.getElementById('ra-dash').addEventListener('click',()=>{
  switchTab('dash'); show('s-dashboard');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATISTICS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStats(){
  const ud=USERS[CU];
  const h=ud.history;
  document.getElementById('so-total').textContent=h.length;
  document.getElementById('so-pts').textContent=ud.points||0;
  const avgs=h.map(x=>x.acc);
  document.getElementById('so-avg').textContent=avgs.length?Math.round(avgs.reduce((a,b)=>a+b,0)/avgs.length)+'%':'‚Äî';

  // per exam performance
  const pg=document.getElementById('perf-grid');
  pg.innerHTML='';
  Object.entries(DB).forEach(([key,ex])=>{
    const exH=h.filter(x=>x.exams&&x.exams.includes(key));
    if(!exH.length) return;
    const avAcc=Math.round(exH.reduce((s,x)=>s+(x.perExam[key]?.acc||0),0)/exH.length);
    const col=avAcc>=80?'var(--green)':avAcc>=50?'var(--amber)':'var(--red)';
    const card=document.createElement('div');
    card.className='perf-card';
    card.innerHTML=`<div class="pc-label">${ex.icon} ${ex.name}</div>
      <div class="pc-val" style="color:${col}">${avAcc}%</div>
      <div style="font-size:.68rem;color:var(--sub);margin-bottom:.4rem">${exH.length} attempt${exH.length>1?'s':''}</div>
      <div class="pc-bar"><div class="pc-fill" style="background:${col};width:${avAcc}%"></div></div>`;
    pg.appendChild(card);
  });
  if(!pg.children.length) pg.innerHTML='<div class="empty-state" style="grid-column:1/-1">No exam data yet</div>';

  // leaderboard (current user only)
  const lb=document.getElementById('leaderboard');
  const me=USERS[CU];
  if(me){
    const pts=me.points||0;
    const quizzes=me.history.length;
    lb.innerHTML=`<div class="lb-row" style="border-color:var(--acc2)">
      <div class="lb-rank gold">ü•á</div>
      <div class="lb-name">${me.name}</div>
      <div class="lb-score">${pts} pts</div>
      <div class="lb-badge">${quizzes} quiz${quizzes!==1?'zes':''}</div>
    </div>`;
  } else {
    lb.innerHTML='<div class="empty-state">No data yet</div>';
  }

  // recent history
  renderHistory('stats-history', h.slice(-8).reverse());
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFETTI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function spawnConfetti(){
  const layer=document.getElementById('cf-layer');
  layer.innerHTML='';
  const cols=['#5b6af0','#8b5cf6','#10d97e','#fbbf24','#ff4d6d','#38bdf8','#f472b6'];
  for(let i=0;i<80;i++){
    const p=document.createElement('div');
    p.className='cf-p';
    p.style.cssText=`left:${Math.random()*100}vw;top:0;background:${cols[i%cols.length]};
      width:${6+Math.random()*8}px;height:${6+Math.random()*8}px;
      border-radius:${Math.random()>.5?'50%':'2px'};
      animation-duration:${2+Math.random()*3}s;animation-delay:${Math.random()*1.5}s`;
    layer.appendChild(p);
  }
  setTimeout(()=>layer.innerHTML='',7000);
}
</script>
</body>
</html>